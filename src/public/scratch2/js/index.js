"use strict";!function(){function e(e){r()}function t(e){a()}function o(){return l.classList.add("loaded"),setTimeout(function(e){l.querySelector(".loader").remove()},1e3),!0}function n(e,t){"scratch2"==t&&r(e)}function r(e){kenrobot.postMessage("app:projectNewOpen","scratch2",e).then(function(e){d=e.extra,u.loadProject(e.data),d.name&&u.setProjectName(d.name),kenrobot.getUserInfo(),kenrobot.trigger("util","message","打开成功")},function(e){kenrobot.trigger("util","message",{text:"打开失败",type:"error"})})}function a(e){var t=function(t){d.path?u.exportProject(e):e||!d.name?kenrobot.trigger("prompt","show",{title:"项目保存",placeholder:"项目名字",callback:function(t){t?(d.name=t,u.setProjectName(d.name),u.exportProject(e)):kenrobot.trigger("util","message",{text:"保存失败",type:"error"})}}):(d.name&&u.setProjectName(d.name),u.exportProject(e))};kenrobot.getUserInfo()||e||d.hasShowSave?t():(d.hasShowSave=!0,kenrobot.trigger("save","show",t))}function c(e,t){(t?kenrobot.postMessage("app:projectNewSaveAs",d.name,"scratch2",e):kenrobot.postMessage("app:projectNewSave",d.name,"scratch2",e,d.path)).then(function(e){(d=Object.assign(d,e)).name&&u.setProjectName(d.name),kenrobot.trigger("util","message","保存成功")},function(e){kenrobot.trigger("util","message",{text:"保存失败",type:"error"})})}function s(){var e=[{key:["ctrl+n","command+n"],callback:function(e){return i("new-project")}},{key:["ctrl+o","command+o"],callback:function(e){return i("open-project")}},{key:["ctrl+s","command+s"],callback:function(e){return i("save-project")}},{key:["ctrl+shift+s","command+shift+s"],callback:function(e){return i("save-as-project")}}];kenrobot.delayTrigger(100,"shortcut","register",e)}function i(e){switch(e){case"new-project":d={},u.newProject();break;case"open-project":r(arguments.length<=1?void 0:arguments[1]);break;case"save-project":a();break;case"save-as-project":a(!0);break;case"undelete":u.undelete();break;case"toggle-samll-stage":u.toggleSmallStage();break;case"toggle-turbo-mode":u.toggleTurboMode();break;case"edit-block-colors":u.editBlockColors()}}var l,u,d={};(function(){function e(e){if(!o&&("onreadystatechange"!==e.type||"complete"===document.readyState)){for(var n=0;n<t.length;n++)t[n].call(document);o=!0,t=null}}var t=[],o=!1;return document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),document.addEventListener("readystatechange",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e)),function(e){o?e.call(document):t.push(e)}})()(function(){window.kenrobot=window.kenrobot||top.kenrobot,u=document.getElementById("ken-scratch");var r=(l=document.querySelector(".player")).querySelector(".toolbar");window.JSeditorReady=o,kenrobot&&!kenrobot.isPC||r.remove(),kenrobot&&(kenrobot.isPC||(r.querySelector(".open").addEventListener("click",e),r.querySelector(".save").addEventListener("click",t)),kenrobot.view.saveProject=c,kenrobot.viewType="scratch2",s(),kenrobot.on("app","command",i).on("project","open-by",n))})}();