"use strict";var _slicedToArray=function(){return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function e(n,t,r){function o(a,u){if(!t[a]){if(!n[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var f=t[a]={exports:{}};n[a][0].call(f.exports,function(e){var t=n[a][1][e];return o(t||e)},f,f.exports,e,n,t,r)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,n,t){n.exports={default:{build:{fqbn:"arduino:avr:uno:cpu=atmega328p",prefs:{"runtime.tools.avr-gcc.path":'"ARDUINO_PATH/hardware/tools/avr"',"runtime.tools.avrdude.path":'"ARDUINO_PATH/hardware/tools/avr"',"build.warn_data_percentage":"75"},target_type:"hex",command:'"ARDUINO_PATH/arduino-builder" -compile -logger=machine -hardware="ARDUINO_PATH/hardware" -hardware="ARDUINO_PATH/packages" -tools="ARDUINO_PATH/tools-builder" -tools="ARDUINO_PATH/hardware/tools/avr" -tools="ARDUINO_PATH/packages" -built-in-libraries="ARDUINO_PATH/libraries" -ide-version=10612 -warnings=none BUILD_SPECS -build-path="PROJECT_BUILD_PATH" "PROJECT_ARDUINO_FILE"'},upload:{target_type:"hex",mcu:"atmega328p",baudrate:"115200",programer:"arduino",command:'"ARDUINO_PATH/hardware/tools/avr/bin/avrdude" -C "ARDUINO_PATH/hardware/tools/avr/etc/avrdude.conf" -v -p ARDUINO_MCU -c ARDUINO_PROGRAMMER -b ARDUINO_BURNRATE -P ARDUINO_COMPORT -D -U "flash:w:TARGET_PATH:i"'}},librariesPath:[]}},{}],2:[function(e,n,t){n.exports={Arduino:-999,Boxz:10,Intel:20,Kenblock:30,UperEnergy:40,standardPackage:"UperEnergy"}},{}],3:[function(e,n,t){n.exports={SUCCESS:0,INVALID_PARAM:1,SYSTEM_ERROR:100,LOGIN_REQUIRED:200,PERMISSION_DENIED:201,INVALID_USER_TOKEN_SIGN:202,USER_TOKEN_EXPIRED:203,USER_NOT_EXITS:204,API_ERROR:300,INVALID_SSO_TICKET:301,INVALID_SSO_SESSION:302,INVALID_SSO_BROKER:303,INVLAID_SSO_SIGN:304}},{}],4:[function(e,n,t){n.exports={CHECK_UPDATE:"http://www.kenrobot.com/downloads/checkupdate",REPORT:"http://userver.kenrobot.com/statistics/report",REGISTER:"http://server.kenrobot.com/register",FIND_PASSWORD:"http://server.kenrobot.com/password/email",LOGIN:"http://server.kenrobot.com/api/auth/login",LOGOUT:"http://server.kenrobot.com/api/auth/logout",WEIXIN_QRCODE:"http://server.kenrobot.com/api/auth/weixin/token",WEIXIN_LOGIN:"http://server.kenrobot.com/api/auth/weixin/login",VERIFY:"http://server.kenrobot.com/api/auth/verify",PACKAGE:"http://www.kenrobot.com/packages/packages.json",PROJECT_SYNC_LIST:"http://server.kenrobot.com/api/project/sync/list",PROJECT_SYNC_CREATE:"http://server.kenrobot.com/api/project/sync/create",PROJECT_SYNC_DELETE:"http://server.kenrobot.com/api/project/sync/delete",PROJECT_SYNC_UPLOAD:"http://server.kenrobot.com/api/project/sync/upload",PROJECT_SYNC_DOWNLOAD:"http://server.kenrobot.com/api/project/sync/download",PROJECT_SYNC_ITEM:"http://server.kenrobot.com/api/project/sync/item"}},{}],5:[function(e,n,t){var r,o,i,a,u,c,s=e("electron"),f=s.app,p=s.BrowserWindow,l=(s.ipcMain,s.shell),d=s.clipboard,m=e("path"),v=e("querystring"),h=e("electron-is"),g=e("electron-debug"),j=e("electron-log"),b=e("q"),P=e("fs-extra"),x=e("command-line-args"),y=e("hasha"),w=e("lodash"),A=e("./util/util"),I=e("./model/serialPort"),S=e("./config/arduinoOptions"),_=e("./config/url"),O=(e("./model/token"),e("./model/project")),D=e("./model/user"),E=e("./model/package"),T=e("./util/cache"),R="config",N=A.listenMessage,k=[{name:"debug-brk",type:Number,defaultValue:!1},{name:"dev",alias:"d",type:Boolean,defaultValue:!1},{name:"devTool",alias:"t",type:Boolean,defaultValue:!1},{name:"fullscreen",alias:"f",type:Boolean,defaultValue:!1},{name:"maximize",alias:"m",type:Boolean,defaultValue:!1},{name:"project",alias:"p",type:O.check,defaultOption:!0}],C=x(k,{argv:process.argv.slice(1),partial:!0});function U(){j.debug("app ready"),h.dev()&&C.devTool&&g({showDevTools:!0}),C.project&&(u=C.project),F(),Y(),function(){if(h.dev()||o.version==A.getVersion())return;o.version=A.getVersion(),o.reportInstall=!1,a=!0,r.setItem(R,o)}(),function(){h.dev()||o.reportInstall||J(null,"installations").then(function(){o.reportInstall=!0,r.setItem(R,o)});J(null,"open")}()}function F(){i=new p({width:1200,height:720,minWidth:1200,minHeight:720,frame:!1,show:!1,webPreferences:{webSecurity:!1}}),C.fullscreen?i.setFullScreen(!0):C.maximize&&i.maximize(),i.on("closed",function(){return i=null}).once("ready-to-show",function(){return i.show()}).on("enter-full-screen",function(){return A.postMessage("app:onFullscreenChange",!0)}).on("leave-full-screen",function(){return A.postMessage("app:onFullscreenChange",!1)}),i.webContents.on("will-navigate",function(e){return e.preventDefault()}).on("devtools-reload-page",function(){return I.closeAllSerialPort()}),i.webContents.session.on("will-download",z),i.loadURL("file://"+__dirname+"/../renderer/index.html"),i.focus()}function q(e,n){e.preventDefault(),u=O.check(n),c&&Q().then(function(e){A.postMessage("app:onLoadProject",e)},function(e){e&&j.info(e)})}function L(e){e.preventDefault(),A.postMessage("app:onBeforeQuit")}function B(e){return I.closeAllSerialPort(),A.removeFile(m.join(A.getAppPath("appData"),"temp"),!0),!0}function J(e,n){var t=b.defer(),r=A.getAppInfo(),o={version:r.version,platform:r.platform,bit:r.appBit,ext:r.ext,branch:r.branch,feature:r.feature};return e=w.merge({},e,o),n=n||"log",A.request(_.REPORT,{method:"post",data:{data:JSON.stringify(e),type:n}}).then(function(){t.resolve()},function(r){j.info("report error: type: "+n+", "+JSON.stringify(e)),r&&j.info(r),t.reject(r)}),t.promise}function M(e){var n=b.defer();return e=0!=e,E.loadAll(e).then(function(e){e.forEach(function(e){var n=m.join(e.path,e.libraries||"src");P.existsSync(n)&&!S.librariesPath.includes(n)&&S.librariesPath.push(n)}),n.resolve(e)},function(e){e&&j.info(e),n.reject(e)}),n.promise}function z(e,n,t){var r=n.getURL(),o=r.lastIndexOf("#"),i=v.parse(r.substring(o+1));r=r.substring(0,o);var a=i.deferId,u=m.join(A.getAppPath("appData"),"download",n.getFilename());if(i.checksum&&P.existsSync(u)){o=i.checksum.indexOf(":");var c=i.checksum.substring(0,o).replace("-","").toLowerCase();if(i.checksum.substring(o+1)==y.fromFileSync(u,{algorithm:c}))return n.cancel(),j.debug("download cancel, "+r+" has cache"),void A.callDefer(a,!0,{path:u})}n.setSavePath(u);var s=n.getTotalBytes();n.on("updated",function(e,t){"interrupted"==t?(j.debug("download interrupted: "+r),A.callDefer(a,!1,{path:u})):"progressing"===t&&(n.isPaused()?(j.debug("download paused: "+r),A.callDefer(a,!1,{path:u})):A.callDefer(a,"notify",{path:u,totalSize:s,size:n.getReceivedBytes()}))}),n.once("done",function(e,n){"completed"==n?(j.debug("download success: "+r+", at "+u),A.callDefer(a,!0,{path:u})):(j.debug("download fail: "+r),A.callDefer(a,!1,{path:u}))})}function G(e,n){A.postMessage("app:onSerialPortError",e,n)}function H(e,n){A.postMessage("app:onSerialPortData",e,n)}function K(e){A.postMessage("app:onSerialPortClose",e)}function V(){var e=b.defer();return I.listSerialPort().then(function(n){var t,r,i,a=(t=/(COM\d+)|(usb-serial)|(arduino)|(\/dev\/cu\.usbmodem)|(\/dev\/tty\.)|(\/dev\/(ttyUSB|ttyACM|ttyAMA))/,n.filter(function(e){return t.test(e.comName)}));0!=a.length?(r=a,i=b.defer(),j.debug("matchBoardNames"),Y().then(function(e){r.forEach(function(e){if(e.productId&&e.vendorId){var n=o.boardNames[e.productId+"_"+e.vendorId];n&&(e.boardName=n.name)}}),i.resolve(r)},function(e){e&&j.info(e),i.reject(e)}),i.promise).then(function(){j.debug(a.map(function(e){return e.comName+", pid: "+e.productId+", vid: "+e.vendorId+", boardName: "+(e.boardName||"")}).join("\n")),e.resolve(a)},function(n){n&&j.info(n),e.reject(n)}):e.reject({status:"NO_ARDUINO_PORT",ports:n})},function(n){n&&j.info(n),e.reject(n)}),e.promise}function W(e,n,t){var r=b.defer();return function(e,n,t){var r=b.defer();j.debug("pre upload firmware");var o=w.merge({},S.default.upload,n.upload),i=A.getAppPath("command","upload"),a=A.handleQuotes(o.command);return a=a.replace(/ARDUINO_PATH/g,A.getAppPath("arduino")).replace("ARDUINO_MCU",o.mcu).replace("ARDUINO_BURNRATE",o.baudrate).replace("ARDUINO_PROGRAMMER",o.programer).replace("ARDUINO_COMPORT",t).replace("TARGET_PATH",e),A.writeFile(i,a).then(function(){I.resetSerialPort(t).then(function(){r.resolve(i)},function(e){e&&j.info(e),r.reject(e)})},function(e){e&&j.info(e),r.reject(e)}),r.promise}(e,n,t).then(function(n){j.debug("upload firmware: "+e+", "+t+", command path: "+n);var o=A.getAppPath("script","call");A.spawnCommand('"'+o+'"',['"'+n+'"'],{shell:!0}).then(function(){r.resolve()},function(e){e&&j.info(e),r.reject(e)},function(e){r.notify(e)})},function(e){e&&j.info(e),r.reject(e)}),r.promise}function Y(e){var n=b.defer();if(o.boardNames&&!e)return j.debug("skip loadBoards"),setTimeout(function(){n.resolve(o.boardNames)},10),n.promise;j.debug("loadBoards");var t={},i=/\n(([^\.\n]+)\.pid(\.\d)?)=([^\r\n]+)/g,a=/\n(([^\.\n]+)\.vid(\.\d)?)=([^\r\n]+)/g,u=/\n([^\.\n]+)\.name=([^\r\n]+)/g,c="arduino-"+A.getPlatform();return A.searchFiles(c+"/**/boards.txt").then(function(e){b.all(e.map(function(e){var n=b.defer();return A.readFile(e).then(function(e){var n=e.match(i),r=e.match(a),o=[];e.match(u).forEach(function(e){var n=e.substring(0,e.indexOf(".name")).trim(),t=e.substring(e.indexOf("=")+1).trim();o[n]=t});var c=n.map(function(e){return e.substring(0,e.indexOf(".pid")).trim()});n=n.map(function(e){return e.substring(e.indexOf("=")+3)}),r=r.map(function(e){return e.substring(e.indexOf("=")+3)}),n.forEach(function(e,n){t[e+"_"+r[n]]={pid:e,vid:r[n],type:c[n],name:o[c[n]]}})}).fin(function(){n.resolve()}),n.promise})).then(function(){o.boardNames=t,r.setItem(R,o),n.resolve(o.boardNames)})},function(e){e&&j.info(e),n.reject(e)}),n.promise}function Q(){if(c=!0,u){j.debug("loadOpenProject: "+u);var e=u;return u=null,O.read(e)}return A.rejectPromise()}!function(){process.on("uncaughtException",function(e){var n=e.stack||e.name+": "+e.message;j.info(n),f.quit()}),h.dev()&&C.dev?(j.transports.console.level="debug",j.transports.file=!1):(j.transports.console=!1,j.transports.file.format="[{y}-{m}-{d} {h}:{i}:{s}] [{level}] {text}",j.transports.file.level="info"),r=new T(R),o=r.getItem(R,{}),A.removeFile(m.join(A.getAppPath("appData"),"config.json"),!0),f.makeSingleInstance(function(e,n){if(i){i.isMinimized()&&i.restore(),i.focus();var t=x(k,{argv:e.slice(1),partial:!0});t.project&&(u=t.project),j.debug("app second run"),Q().then(function(e){A.postMessage("app:onLoadProject",e)},function(e){e&&j.info(e)})}})&&f.quit();f.on("ready",U).on("window-all-closed",function(){return"darwin"!==process.platform&&f.quit()}).on("activate",function(){return null===i&&F()}).on("before-quit",L).on("will-quit",B).on("quit",function(){return j.debug("app quit")}),h.macOS()&&f.on("open-file",q),function(){N("getAppInfo",function(){return A.resolvePromise(A.getAppInfo())}),N("execFile",function(e){return A.execFile(e)}),N("execCommand",function(e,n){return A.execCommand(e,n)}),N("spawnCommand",function(e,n,t){return A.spawnCommand(e,n,t)}),N("readFile",function(e,n){return A.readFile(e,n)}),N("writeFile",function(e,n){return A.writeFile(e,n)}),N("saveFile",function(e,n,t){return A.saveFile(e,n,t)}),N("moveFile",function(e,n,t){return A.moveFile(e,n,t)}),N("removeFile",function(e){return A.removeFile(e)}),N("readJson",function(e,n){return A.readJson(e,n)}),N("writeJson",function(e,n,t,r){return A.writeJson(e,n,t,r)}),N("showOpenDialog",function(e){return A.showOpenDialog(e)}),N("showSaveDialog",function(e){return A.showSaveDialog(e)}),N("request",function(e,n,t){return A.request(e,n,t)}),N("showItemInFolder",function(e){return l.showItemInFolder(m.normalize(e))}),N("openUrl",function(e){return A.resolvePromise(e&&l.openExternal(e))}),N("listSerialPort",function(){return V()}),N("openSerialPort",function(e,n){return t=e,r=n,I.openSerialPort(t,r,{onError:G,onData:H,onClose:K});var t,r}),N("writeSerialPort",function(e,n){return I.writeSerialPort(e,n)}),N("closeSerialPort",function(e){return I.closeSerialPort(e)}),N("updateSerialPort",function(e,n){return I.updateSerialPort(e,n)}),N("flushSerialPort",function(e){return I.flushSerialPort(e)}),N("buildProject",function(e,n){return t=e,r=n,o=b.defer(),function(e,n){var t=b.defer();j.debug("pre-build");var r=m.join(e,"cache"),o=m.join(r,"build");return P.ensureDirSync(o),A.removeFile(m.join(o,"sketch","build"),!0),A.removeFile(m.join(e,"build"),!0),O.read(e).then(function(e){var i=e.data,a=m.join(r,i.project_name+".ino");A.writeFile(a,i.project_data.code).then(function(){var e=[],r=w.merge({},S.default.build,n.build),i=A.getAppPath("packages");P.existsSync(i)&&e.push("-hardware="+i),e.push("-fqbn="+r.fqbn);var u=A.getAppPath("arduino");Object.keys(r.prefs).forEach(function(n){var t=A.handleQuotes(r.prefs[n]);t=t.replace(/ARDUINO_PATH/g,u),e.push("-prefs="+n+"="+t)});var c=A.getAppPath("libraries");P.existsSync(c)&&e.push('-libraries="'+c+'"'),S.librariesPath.forEach(function(n){e.push('-libraries="'+n+'"')});var s=A.getAppPath("command","build"),f=A.handleQuotes(r.command);f=f.replace(/ARDUINO_PATH/g,A.getAppPath("arduino")).replace("BUILD_SPECS",e.join(" ")).replace("PROJECT_BUILD_PATH",o).replace("PROJECT_ARDUINO_FILE",a),A.writeFile(s,f).then(function(){var e=m.join(o,"build.options.json");if(!P.existsSync(e))return setTimeout(function(){return t.resolve(s)},10),t.promise;A.readJson(e).then(function(e){r.fqbn!=e.fqbn?A.removeFile(o).fin(function(){P.ensureDirSync(o),t.resolve(s)}):t.resolve(s)},function(e){e&&j.info(e),t.resolve(s)})},function(e){e&&j.info(e),t.reject()})},function(e){e&&j.info(e),t.reject()})},function(e){e&&j.info(e),t.reject()}),t.promise}(t,r).then(function(e){j.debug("buildProject: "+t+", command path: "+e);var n=A.getAppPath("script","call");A.spawnCommand('"'+n+'"',['"'+e+'"'],{shell:!0}).then(function(){var e=w.merge({},S.default,r),n=m.join(t,"cache","build",m.basename(t)+".ino."+e.upload.target_type);o.resolve(n)},function(e){e&&j.info(e),o.reject(e)},function(e){o.notify(e)})},function(e){e&&j.info(e),o.reject(e)}),o.promise;var t,r,o}),N("uploadFirmware",function(e,n,t){return function(e,n,t){if(!t){var r=b.defer();return V().then(function(t){1==t.length?W(e,n,t[0].comName).then(function(){r.resolve()},function(e){r.reject(e)},function(e){r.notify(e)}):r.reject({status:"SELECT_PORT",ports:t})},function(e){e&&"NO_ARDUINO_PORT"===e.status?r.reject(e):r.reject({status:"PORT_NOT_FOUND"})}),r.promise}return W(e,n,t)}(e,n,t)}),N("download",function(e,n){return function(e,n){var t=b.defer(),r=A.getDefer(),o=r.deferId,a=r.promise;n.deferId=o;var u=v.stringify(n);return j.debug("download "+e+", options: "+u),a.then(function(e){t.resolve(e)},function(e){e&&j.info(e),t.reject(e)},function(e){t.notify(e)}),i.webContents.downloadURL(e+"#"+u),t.promise}(e,n)}),N("installDriver",function(e){return function(e){var n=b.defer();j.debug("installDriver: "+e);var t=m.join(A.getAppPath("appData"),"temp");return A.uncompress(e,t).then(function(){var r=m.join(t,m.basename(e,m.extname(e)),"setup.exe");A.execFile(r).then(function(){n.resolve()})},function(e){e&&j.info(e),n.reject(e)}),n.promise}(e)}),N("loadExamples",function(){return E.loadExamples()}),N("openExample",function(e){return n=e,t=b.defer(),j.debug("openExample: "+n),O.read(n).then(function(e){e.path=null,t.resolve(e)},function(e){e&&j.info(e),t.reject(e)}),t.promise;var n,t}),N("unzipPackage",function(e,n,t){return E.unzip(e,n,t)}),N("deletePackage",function(e){return E.remove(e)}),N("unzipPackages",function(e){return n=e,t=b.defer(),n=!1===n&&h.dev(),E.unzipAll(o.packages,n,a).then(function(e){h.dev()?t.resolve():(o.packages=e,r.setItem(R,o),t.resolve())},function(e){e&&j.info(e),t.reject(e)},function(e){return t.notify(e)}),t.promise;var n,t}),N("loadPackages",function(e){return M(e)}),N("loadRemotePackages",function(){return E.loadRemote()}),N("getInstalledLibraries",function(){return e=b.defer(),n=/^([^=]+)=(.*)$/gm,A.searchFiles(A.getAppPath("libraries")+"/**/library.properties").then(function(t){var r=[];b.all(t.map(function(e){var t=b.defer();return A.readFile(e).then(function(e){var t=e.match(n);if(!(t.length<0)){var o={};t.map(function(e){return e.split("=")}).forEach(function(e){o[e[0]]=e[1]}),o.name&&o.version&&r.push(o)}}).fin(function(){t.resolve()}),t.promise})).then(function(){e.resolve(r)})},function(n){n&&j.info(n),e.reject(n)}),e.promise;var e,n}),N("loadLibraries",function(){return e=b.defer(),A.readJson(m.join(A.getAppPath("appResource"),"libraries","libraries.json")).then(function(n){e.resolve(n.libraries)},function(n){n&&j.info(n),e.reject(n)}),e.promise;var e}),N("unzipLibrary",function(e,n){return t=e,r=n,o=b.defer(),i=A.getAppPath("libraries"),a=m.basename(r,m.extname(r)),A.uncompress(r,i,!0).then(function(){A.moveFile(m.join(i,a),m.join(i,t)).then(function(){o.resolve()},function(e){e&&j.info(e),o.reject(e)})},function(e){e&&j.info(e),o.reject(e)},function(e){o.notify(e)}),o.promise;var t,r,o,i,a}),N("deleteLibrary",function(e){return n=e,t=b.defer(),j.debug("deleteLibrary: "+n),A.removeFile(m.join(A.getAppPath("libraries"),n)).then(function(){t.resolve()},function(e){e&&j.info(e),t.reject(e)}),t.promise;var n,t}),N("checkUpdate",function(){return e=b.defer(),n=A.getAppInfo(),t=n.feature?n.feature+","+n.arch:n.arch,r=_.CHECK_UPDATE+"?appname="+n.name+"&release_version="+n.branch+"&version="+n.version+"&platform="+n.platform+"&ext="+n.ext+"&features="+t,j.debug("checkUpdate: "+r),A.request(r).then(function(n){e.resolve(n)},function(n){n&&j.info(n),e.reject(n)}),e.promise;var e,n,t,r}),N("checkPackageLibraryUpdate",function(){return e=b.defer(),b.all([M(!1),E.loadRemote()]).then(function(n){var t=n[0],r=n[1],o=[];t.forEach(function(e){var n=r.find(function(n){return n.name==e.name&&A.versionCompare(n.version,e.version)>0});n&&o.push(n)});var i=0;o.length>0&&(i=1),e.resolve({status:i})},function(n){n&&j.info(n),e.reject(n)}),e.promise;var e}),N("removeOldVersions",function(e){return n=e,t=b.defer(),r=A.getAppInfo(),o=m.join(A.getAppPath("appData"),"download"),A.searchFiles(o+"/"+r.name+"-*."+r.ext).then(function(e){var r=/\d+\.\d+\.\d+/;e.map(function(e){return m.basename(e)}).filter(function(e){var t=e.match(r);return!!t&&A.versionCompare(t[0],n)<0}).forEach(function(e){A.removeFile(m.join(o,e),!0)}),t.resolve()},function(e){e&&j.info(e),t.reject(e)}),t.promise;var n,t,r,o}),N("reportToServer",function(e,n){return J(e,n)}),N("loadToken",function(){return D.loadToken()}),N("login",function(e,n){return D.login(e,n)}),N("logout",function(){return D.logout()}),N("weixinLogin",function(e){return D.weixinLogin(e)}),N("weixinQrcode",function(){return D.weixinQrcode()}),N("register",function(e){return D.register(e)}),N("resetPassword",function(e){return D.resetPassword(e)}),N("setCache",function(e,n){return e!==R?r.setItem(e,n):A.rejectPromise()}),N("getCache",function(e,n){return e!==R?A.resolvePromise(r.getItem(e,n)):A.rejectPromise()}),N("loadOpenOrRecentProject",function(){return e=b.defer(),Q().then(function(n){e.resolve(n)},function(){var n=r.getItem("recentProject");n?O.read(n).then(function(n){e.resolve(n)},function(n){e.reject(n)}):A.rejectPromise(null,e)}),e.promise;var e}),N("projectRead",function(e){return O.read(e)}),N("projectOpen",function(e){return O.open(e)}),N("projectSave",function(e,n,t){return O.save(e,n,t)}),N("projectSaveAs",function(e,n,t){return O.saveAs(e,n,t)}),N("projectSync",function(){return O.sync()}),N("projectList",function(){return O.list()}),h.dev()&&(N("projectCreate",function(e){return O.create(e)}),N("projectUpload",function(e,n){return O.upload(e,n)}),N("projectDelete",function(e,n){return O.remove(e,n)}),N("projectDownload",function(e,n){return O.download(e,n)}));N("log",function(e,n){return(j[n]||j.debug).bind(j).call(e)}),N("copy",function(e,n){return d.writeText(e,n)}),N("quit",function(){return f.quit()}),N("exit",function(){return B()&&f.exit(0)}),N("reload",function(){return i.reload()}),N("relaunch",function(){return f.relaunch({args:process.argv.slice(1).concat(["--relaunch"])}),void f.exit(0)}),N("fullscreen",function(){return i.setFullScreen(!i.isFullScreen())}),N("min",function(){return i.minimize()}),N("max",function(){i.isFullScreen()?i.setFullScreen(!1):i.isMaximized()?i.unmaximize():i.maximize()}),N("errorReport",function(e,n){return t=e,r=n,void j.info(r+": "+t);var t,r})}(),j.debug("app "+f.getName()+" start, version "+A.getVersion())}()},{"./config/arduinoOptions":1,"./config/url":4,"./model/package":6,"./model/project":7,"./model/serialPort":8,"./model/token":9,"./model/user":10,"./util/cache":11,"./util/util":12,"command-line-args":void 0,electron:void 0,"electron-debug":void 0,"electron-is":void 0,"electron-log":void 0,"fs-extra":void 0,hasha:void 0,lodash:void 0,path:void 0,q:void 0,querystring:void 0}],6:[function(e,n,t){var r=e("path"),o=e("fs-extra"),i=e("q"),a=e("electron-log"),u=e("electron-is"),c=e("lodash"),s=e("../util/util"),f=e("../config/packageOrders"),p=e("../config/url");function l(e){var n=i.defer();return a.debug("deletePackage: "+e),s.removeFile(r.join(s.getAppPath("packages"),e)).then(function(){n.resolve()},function(e){e&&a.info(e),n.reject(e)}),n.promise}n.exports.unzip=function(e,n,t){var o=i.defer(),c=function(){s.uncompress(n,s.getAppPath("packages"),!0).then(function(){var e=r.basename(n);e=e.substring(0,e.indexOf("-"));var t=u.windows()?"bat":"sh";s.searchFiles(r.join(s.getAppPath("packages"),e)+"/**/post_install."+t).then(function(e){if(0!=e.length){var n=e[0];s.execCommand('"'+n+'"',{cwd:r.dirname(n)}).then(function(){o.resolve()},function(e){e&&a.info(e),o.reject(e)})}else o.resolve()},function(e){e&&a.info(e),o.reject(e)})},function(e){e&&a.info(e),o.reject(e)},function(e){o.notify(e)})};return(t=!1!==t)?l(e).then(function(){return c()},function(e){e&&a.info(e),o.reject(e)}):c(),o.promise},n.exports.unzipAll=function(e,n,t){var u=i.defer();if(e=e||[],n)return a.debug("skip unzip packages"),setTimeout(function(){return u.resolve()},10),u.promise;a.debug("unzip packages");var c=r.join(s.getAppPath("appResource"),"packages");return s.readJson(r.join(c,"packages.json")).then(function(n){var i=n.filter(function(n){return!!t||!!e.find(function(e){return e.name==n.name&&e.checksum!=n.checksum})||!o.existsSync(r.join(s.getAppPath("packages"),n.name,"package.json"))}),a=i.length;!function n(){if(0!=i.length){var t=i.pop();s.uncompress(r.join(c,t.archiveName),s.getAppPath("packages"),!0).then(function(){var n=e.findIndex(function(e){return e.name==t.name});n>=0?e.splice(n,1,t):e.push(t)},function(e){},function(e){u.notify({progress:e,name:t.name,version:t.version,count:a-i.length,total:a})}).fin(function(){return n()})}else u.resolve(e)}()},function(e){e&&a.info(e),u.resolve()}),u.promise},n.exports.loadAll=function(e){var n=i.defer();e=!1!==e;var t=[],o=[s.getAppPath("appResource")+"/packages/*/package.json"];return a.debug("loadPackages: "+o.join(",")),s.searchFiles(o,{absolute:!0}).then(function(o){i.all(o.map(function(n){var o=i.defer();return e?s.readJson(n).then(function(e){f[e.name]&&(e.order=f[e.name]),e.name==f.standardPackage&&(e.builtIn=!0),e.path=r.dirname(n),e.protocol=n.startsWith("/")?"file://":"file:///",e.boards&&e.boards.forEach(function(n){n.build&&n.build.prefs&&Object.keys(n.build.prefs).forEach(function(t){n.build.prefs[t]=n.build.prefs[t].replace("PACKAGE_PATH",e.path)}),n.upload&&n.upload.command&&(n.upload.command=n.upload.command.replace(/PACKAGE_PATH/g,e.path))}),t.push(e)}).fin(function(){o.resolve()}):s.readJson(n).then(function(e){e.path=r.dirname(n),t.push(e)}).fin(function(){return o.resolve()}),o.promise})).then(function(){n.resolve(c.sortBy(t,["builtIn","order","name"],["asc","asc","asc"]))})},function(e){e&&a.info(e),n.reject(e)}),n.promise},n.exports.loadRemote=function(){var e=i.defer(),n=s.getAppInfo();return s.request(p.PACKAGE).then(function(t){var r=t.filter(function(e){return e.platform==n.platform});r.forEach(function(e){f[e.name]&&(e.order=f[e.name]),e.name==f.standardPackage&&(e.builtIn=!0)}),e.resolve(c.sortBy(r,["builtIn","order","name"],["asc","asc","asc"]))},function(n){n&&a.info(n),e.reject(n)}),e.promise},n.exports.remove=l,n.exports.loadExamples=function(){var e=i.defer(),n=[],t=[s.getAppPath("appResource")+"/packages/*/examples/examples.json"];return a.debug("loadExamples: "+t.join(",")),s.searchFiles(t,{absolute:!0}).then(function(t){i.all(t.map(function(e){var t=i.defer();return s.readJson(e).then(function(t){f[t.package]&&(t.order=f[t.package]),t.package==f.standardPackage&&(t.builtIn=!0),t.examples.forEach(function(n){n.path=r.join(r.dirname(e),n.category,n.name)}),n.push(t)}).fin(function(){return t.resolve()}),t.promise})).then(function(){e.resolve(c.sortBy(n,["builtIn","order","name"],["asc","asc","asc"]))})},function(n){n&&a.info(n),e.reject(n)}),e.promise}},{"../config/packageOrders":2,"../config/url":4,"../util/util":12,"electron-is":void 0,"electron-log":void 0,"fs-extra":void 0,lodash:void 0,path:void 0,q:void 0}],7:[function(e,n,t){var r=e("path"),o=e("fs-extra"),i=e("q"),a=e("hasha"),u=e("electron-log"),c=(e("lodash"),e("../util/util")),s=e("./token"),f=e("../config/url"),p=".upr",l="uper",d=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],m=96,v=c.throttle(b,3e3);function h(e){return e&&r.extname(e)==p&&o.existsSync(e)?e:null}function g(e){var n,t=i.defer();if(h(e))n=e;else{var a=r.basename(e);if(n=r.join(e,a+p),o.existsSync(n)||(n=r.join(e,"project.json")),!o.existsSync(n))return c.rejectPromise(null,t)}return c.readJson(n).then(function(e){t.resolve({path:r.dirname(n),project_type:e.project_type||"local",data:e})},function(e){e&&u.info(e),t.reject(e)}),t.promise}function j(e,n,t,o){var a,s,f,p,l=i.defer(),v=function(e,t){A(e,t,n).then(function(){l.resolve({project_name:n.project_name,project_type:n.project_type,updated_at:n.updated_at,path:e})},function(e){e&&u.info(e),l.reject(e)})};return t?(o=r.join(c.getAppPath("temp"),"build","sketch_"+c.stamp()),v(o,r.basename(o))):o?v(r.join(r.dirname(o),e),e):c.showSaveDialog({defaultPath:(a=new Date,s=d[a.getMonth()],f=(100+a.getDate()).toString().substring(1),m++,p=String.fromCharCode(m<=122?m:m=97),"sketch_"+s+f+p)}).then(function(e){v(e,r.basename(e))},function(e){e&&u.info(e),l.reject(e)}),l.promise}function b(){var e=i.defer();return u.debug("project sync"),i.all([P(),I()]).then(function(n){var t=_slicedToArray(n,2);(function(e,n){var t=i.defer(),o=function(e,n){var t={},o={};e.forEach(function(e){t[""+e.name]=e}),n.forEach(function(e){o[""+e.name]=e});var i=[],a=[],u=[];return e.forEach(function(e){var n=o[e.name];!n||!n.modify_time||n.modify_time<e.modify_time?i.push(e):h(r.join(D(),e.name,e.name+p))||i.push(e)}),n.forEach(function(e){var n=t[e.name];n?n.modify_time<e.modify_time&&a.push(e):(u.push(e),a.push(e))}),[u,i,a]}(e,n),a=_slicedToArray(o,3),s=a[0],f=a[1],l=a[2];u.debug("doSync: createList:"+s.length+", downloadList:"+f.length+", uploadList:"+l.length);var d=s.length+f.length+l.length,m=0,v=function(e,n){m++,t.notify({total:d,count:m,name:e,action:n})};return(g=f,j=v,P=i.defer(),(b=function(){if(0==g.length)return c.resolvePromise(!0,P);var e=g.shift();w(e.name,e.hash).then(function(){j(e.name,"download"),0==g.length?P.resolve():setTimeout(function(){return b()},100)},function(e){e&&u.info(e),P.reject(e)})})(),P.promise).then(function(){var e,n,r,o;(e=s,n=v,o=i.defer(),(r=function(){if(0==e.length)return c.resolvePromise(!0,o);var t=e.shift();x(t.name).then(function(i){t.hash=i.hash,n(t.name,"create"),0==e.length?o.resolve():setTimeout(function(){return r()},100)},function(e){e&&u.info(e),o.reject(e)})})(),o.promise).then(function(){var e,n,r,o;(e=l,n=v,o=i.defer(),(r=function(){if(0==e.length)return c.resolvePromise(!0,o);var t=e.shift();y(t.name,t.hash).then(function(){n(t.name,"upload"),0==e.length?o.resolve():setTimeout(function(){return r()},100)},function(e){e&&u.info(e),o.reject(e)})})(),o.promise).then(function(){t.resolve()},function(e){e&&u.info(e),t.reject(e)})},function(e){e&&u.info(e),t.reject(e)})},function(e){e&&u.info(e),t.reject(e)}),t.promise;var g,j,b,P})(t[0],t[1]).then(function(){u.debug("project sync success"),e.resolve()},function(n){u.debug("project sync fail"),n&&u.info(n),e.reject(n)},function(n){e.notify(n)})},function(n){n&&u.info(n),e.reject(n)}),e.promise}function P(){var e=i.defer();return u.debug("project list"),s.request(f.PROJECT_SYNC_LIST,{method:"post"}).then(function(n){0==n.status?e.resolve(n.data.filter(function(e){return e.type==l})):e.reject(n.message)},function(n){n&&u.info(n),e.reject(n)}),e.promise}function x(e){var n=i.defer();return u.debug("project create: "+e),s.request(f.PROJECT_SYNC_CREATE,{method:"post",data:{name:e,type:l}}).then(function(t){if(0==t.status){var r=t.data;_(r.name,r.modify_time,r.hash).then(function(){u.debug("project create success: "+e+" "+r.hash),n.resolve(r)},function(e){e&&u.info(e),n.reject(e)})}else n.reject(t.message)},function(e){e&&u.info(e),n.reject(e)}),n.promise}function y(e,n){var t,a,l,d,m,v=i.defer();return u.debug("project upload: "+e+": "+n),(t=D(),a=e,l=i.defer(),d=r.join(c.getAppPath("appData"),"temp",c.uuid(6)+".7z"),m=[a+"/"+a+p],c.compress(t,m,d).then(function(){l.resolve(d)},function(e){e&&u.info(e),l.reject(e)}),l.promise).then(function(t){var r=f.PROJECT_SYNC_UPLOAD+"/"+n;s.request(r,{method:"post",body:o.createReadStream(t)}).then(function(t){if(0==t.status){var r=t.data;_(e,r.modify_time,n).then(function(){u.debug("project upload success: "+e),v.resolve(r)},function(e){e&&u.info(e),v.reject(e)})}else v.reject(t.message)},function(e){e&&u.info(e),v.reject(e)})},function(e){e&&u.info(e),v.reject(e)}),v.promise}function w(e,n){var t=i.defer();u.debug("project download: "+n);var a=f.PROJECT_SYNC_DOWNLOAD+"/"+n;return s.request(a,{method:"post"},!1).then(function(i){var a=r.join(c.getAppPath("appData"),"temp",c.uuid(6)+".7z");o.ensureDirSync(r.dirname(a));var s=o.createWriteStream(a);i.body.pipe(s),i.body.on("end",function(){c.uncompress(a,D()).then(function(){_(e,null,n).then(function(){u.debug("project download success: "+e),t.resolve()},function(e){e&&u.info(e),t.reject(e)})},function(e){e&&u.info(e),t.reject(e)})}).on("error",function(e){e&&u.info(e),t.reject(e)})},function(e){e&&u.info(e),t.reject(e)}),t.promise}function A(e,n,t,o){t.project_name=n,t.project_type=o||"local",t.updated_at=new Date;var a=r.join(e,n+p);return u.debug("project save: "+a),i.all([c.writeJson(a,t),c.removeFile(r.join(e,n+".ino")),c.removeFile(r.join(e,"project.json"))])}function I(){var e=i.defer();if(!s.getUser())return c.rejectPromise(null,e);var n=O();return o.existsSync(n)?c.readJson(n):c.resolvePromise([],e)}function S(e){return s.getUser()?c.writeJson(O(),e):c.rejectPromise()}function _(e,n,t){var r=i.defer();return n=n||c.stamp(),I().then(function(o){var i=o.find(function(n){return t&&n.hash==t||n.name==e});i?(e&&(i.name=e),t&&(i.hash=t),i.modify_time=n):o.push({name:e,hash:t,modify_time:n}),S(o).then(function(){r.resolve()},function(e){e&&u.info(e),r.reject(e)})},function(e){e&&u.info(e),r.reject(e)}),r.promise}function O(){var e=s.getUserId();return e?r.join(c.getAppPath("appData"),"projects",E(e,1),"list.json"):null}function D(){var e=s.getUserId();return e?r.join(c.getAppPath("appDocuments"),"projects",E(e)):null}function E(e,n){return n=n||0,a(""+e,{algorithm:"md5"}).substring(8*n,8*(n+1))}n.exports.check=h,n.exports.read=g,n.exports.open=function(e){var n=i.defer(),t=function(e){g(e).then(function(e){n.resolve(e)},function(e){e&&u.info(e),n.reject(e)})};if(e)return s.getUser()?(t(r.join(D(),e)),n.promise):c.rejectPromise(null,n);var o={};return o.defaultPath=s.getUser()?D():c.getAppPath("documents"),o.properties=["openDirectory"],c.showOpenDialog(o).then(function(e){t(e)},function(e){e&&u.info(e),n.reject(e)}),n.promise},n.exports.save=function(e,n,t){var o=i.defer();if(!s.getUser()){var a=r.join(c.getAppPath("appDocuments"),"projects");return t&&t.startsWith(a)&&(t=null),j(e,n,!1,t)}return A(t=r.join(D(),e),e,n,"cloud").then(function(){_(e).then(function(){v(),o.resolve({project_name:n.project_name,project_type:n.project_type,updated_at:n.updated_at,path:t})},function(e){e&&u.info(e),o.reject(e)})},function(e){e&&u.info(e),o.reject(e)}),o.promise},n.exports.saveAs=j,n.exports.sync=b,n.exports.list=P,n.exports.create=x,n.exports.remove=function(e,n){var t=i.defer();return u.debug("project remove: "+n),s.request(f.PROJECT_SYNC_DELETE,{method:"post",data:{hash:n}}).then(function(o){var a,s;0==o.status?i.all([c.removeFile(r.join(D(),e)),(a=n,s=i.defer(),I().then(function(e){var n=e.findIndex(function(e){return e.hash==a});n<0?s.resolve():(e.splice(n,1),S(e).then(function(){s.resolve()},function(e){e&&u.info(e),s.reject(e)}))},function(e){e&&u.info(e),s.reject(e)}),s.promise)]).then(function(){u.debug("project remove success: "+e),t.resolve()},function(e){e&&u.info(e),t.reject(e)}):t.reject(o.message)},function(e){e&&u.info(e),t.reject(e)}),t.promise},n.exports.upload=y,n.exports.download=w},{"../config/url":4,"../util/util":12,"./token":9,"electron-log":void 0,"fs-extra":void 0,hasha:void 0,lodash:void 0,path:void 0,q:void 0}],8:[function(e,n,t){e("path");var r=e("electron-log"),o=e("q"),i=e("serialport"),a=i.parsers.Delimiter,u={autoPortId:0,ports:{}};n.exports.listSerialPort=function(){var e=o.defer();return r.debug("listSerialPort"),i.list(function(n,t){if(n)return r.info(n),void e.reject(n);0!=t.length?e.resolve(t):e.reject()}),e.promise},n.exports.openSerialPort=function(e,n,t){var c=o.defer();r.debug("openSerialPort: "+e+", options: "+JSON.stringify(n)),n.autoOpen=!1;var s=new i(e,n);return s.open(function(e){if(e)return r.info(e),void c.reject(e);var o=++u.autoPortId;u.ports[o]=s,s.on("error",function(e){t&&t.onError&&t.onError(o,e)}),s.on("close",function(){delete u.ports[o],t&&t.onClose&&t.onClose(o)});var i="raw"==n.parser?s:s.pipe(new a({delimiter:Buffer.from(n.parser)}));i.on("readable",function(){var e=i.read();e&&t&&t.onData&&t.onData(o,e)}),s.flush(function(){c.resolve(o)})}),c.promise},n.exports.writeSerialPort=function(e,n){var t=o.defer();r.debug("writeSerialPort: "+e+", "+n);var i=u.ports[e];return i?(i.write(Buffer.from(n),function(e){if(e)return r.info(e),void t.reject(e);i.drain(function(){t.resolve()})}),t.promise):(setTimeout(function(){return t.reject()},10),t.promise)},n.exports.closeSerialPort=function(e){var n=o.defer();r.debug("closeSerialPort, portId: "+e);var t=u.ports[e];return t?(t.close(function(){n.resolve()}),n.promise):(setTimeout(function(){return n.reject()},10),n.promise)},n.exports.closeAllSerialPort=function(){r.debug("closeAllSerialPort");for(var e in u.ports)u.ports[e].close();u.ports={}},n.exports.updateSerialPort=function(e,n){var t=o.defer();r.debug("updateSerialPort, portId: "+e);var i=u.ports[e];return i?(i.update(n,function(){t.resolve()}),t.promise):(setTimeout(function(){return t.reject()},10),t.promise)},n.exports.flushSerialPort=function(e,n){var t=o.defer();r.debug("flushSerialPort, portId: "+e);var i=u.ports[e];return i?(i.flush(function(){t.resolve()}),t.promise):(setTimeout(function(){return t.reject()},10),t.promise)},n.exports.resetSerialPort=function(e){var n=o.defer(),t=new i(e,{baudRate:1200});return t.on("open",function(){t.set({rts:!0,dtr:!1}),setTimeout(function(){t.close(function(){return n.resolve()})},650)}).on("error",function(e){r.info(e),t.close(function(){n.reject(e)})}),n.promise}},{"electron-log":void 0,path:void 0,q:void 0,serialport:void 0}],9:[function(e,n,t){e("path");var r,o,i=e("crypto"),a=e("q"),u=(e("fs-extra"),e("electron-log")),c=e("is-online"),s=e("../util/util"),f=e("../config/url"),p=e("../config/status"),l=e("../util/cache");function d(){o=null,v().removeItem("key",!1),v().removeItem("value",!1),v().save()}function m(e,n,t){if(!o)return s.rejectPromise();var r=s.getAppInfo(),i=n.headers||{};return i.Authorization="Bearer "+o.api_token,i["X-Ken-App-Version"]=r.name+"-"+r.version+"-"+r.branch+"-"+r.platform+"-"+r.appBit,n.headers=i,s.request(e,n,t)}function v(){return r||(r=new l("token")),r}n.exports.getUser=function(){return o&&o.user?o.user:null},n.exports.getUserId=function(){return o&&o.user?o.user.id:0},n.exports.load=function(){var e,n=a.defer(),t=v().getItem("key"),r=v().getItem("value");if(!t||!r)return s.rejectPromise(null,n);try{var i=s.decrypt(r,Buffer.from(t,"hex"));o=JSON.parse(i),(e=a.defer(),m(f.VERIFY,{method:"post"}).then(function(n){n.status==p.SUCCESS?e.resolve():e.reject(n.message)},function(n){n&&u.info(n),e.reject(n)}),e.promise).then(function(){n.resolve(o)},function(e){c().then(function(){return d()}).fin(function(){e&&u.info(e),n.reject(e)})})}catch(e){n.reject()}return n.promise},n.exports.save=function(e){try{var n=i.randomBytes(128);return v().setItem("key",n.toString("hex"),!1),v().setItem("value",s.encrypt(JSON.stringify(e),n),!1),v().save(),o=e,s.resolvePromise()}catch(e){return s.rejectPromise(e)}},n.exports.remove=d,n.exports.request=m},{"../config/status":3,"../config/url":4,"../util/cache":11,"../util/util":12,crypto:void 0,"electron-log":void 0,"fs-extra":void 0,"is-online":void 0,path:void 0,q:void 0}],10:[function(e,n,t){var r=e("q"),o=e("electron-log"),i=e("../util/util"),a=e("./token"),u=e("../config/url"),c=(e("../config/status"),/^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/);n.exports.loadToken=function(){var e=r.defer();return a.load().then(function(n){e.resolve(n.user)},function(n){n&&o.info(er),e.reject(n)}),e.promise},n.exports.login=function(e,n,t){var s=r.defer(),f={};return c.test(e)?f.email=e:f.username=e,f.password=n,i.request(u.LOGIN,{method:"POST",data:f}).then(function(e){0==e.status?a.save(e.data).fin(function(){s.resolve(e)}):s.resolve(e)},function(e){e&&o.info(er),s.reject(e)}),s.promise},n.exports.logout=function(){var e=r.defer();return a.remove(),i.request(u.LOGOUT).then(function(){e.resolve()},function(n){n&&o.info(n),e.reject(n)}),e.promise},n.exports.weixinLogin=function(e){var n=r.defer();return i.request(u.WEIXIN_LOGIN,{method:"POST",data:{auth_key:e}}).then(function(e){0==e.status||1==e.status?a.save(e.data).fin(function(){n.resolve(e)}):n.resolve(e)},function(e){e&&o.info(e),n.reject(e)}),n.promise},n.exports.weixinQrcode=function(){var e=r.defer();return i.request(u.WEIXIN_QRCODE).then(function(n){e.resolve(n)},function(n){n&&o.info(n),e.reject(n)}),e.promise},n.exports.register=function(e){var n=r.defer();return i.request(u.REGISTER,{method:"POST",data:{email:e.email,username:e.username,password:e.password,login:!0}}).then(function(e){n.resolve(e)},function(e){e&&o.info(e),n.reject(e)}),n.promise},n.exports.resetPassword=function(e){var n=r.defer();return i.request(u.FIND_PASSWORD,{method:"POST",data:{email:e}}).then(function(e){n.resolve(e)},function(e){e&&o.info(e),n.reject(e)}),n.promise}},{"../config/status":3,"../config/url":4,"../util/util":12,"./token":9,"electron-log":void 0,q:void 0}],11:[function(e,n,t){e("path"),e("crypto"),e("q"),e("fs-extra"),e("electron-log");var r=e("flat-cache"),o=e("./util"),i={};function a(e){if(i[e])return i[e];this.name=e,this._cache=r.load(e,o.getAppPath("appData")),i[e]=this}a.prototype.getItem=function(e,n){var t=this._cache.getKey(e);return void 0!==t?t:n},a.prototype.setItem=function(e,n,t){t=!1!==t,this._cache.setKey(e,n),t&&this._cache.save(!0)},a.prototype.removeItem=function(e,n){n=!1!==n,this._cache.removeKey(e),n&&this._cache.save(!0)},a.prototype.save=function(){this._cache.save(!0)},n.exports=a},{"./util":12,crypto:void 0,"electron-log":void 0,"flat-cache":void 0,"fs-extra":void 0,path:void 0,q:void 0}],12:[function(e,n,t){var r=e("os"),o=e("child_process"),i=e("path"),a=e("crypto"),u=e("electron"),c=u.app,s=u.ipcMain,f=u.dialog,p=u.BrowserWindow,l=e("electron-log"),d=e("electron-is"),m=e("q"),v=e("fs-extra"),h=e("globby"),g=e("sudo-prompt"),j=e("iconv-lite"),b=(e("lodash"),e("7zip-bin").path7za.replace("app.asar","app.asar.unpacked")),P=e("node-fetch"),x=e(d.dev()?i.resolve("app","package.json"):i.resolve(__dirname,"..","package.json")),y="-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC7Jat1/19NDxOObrFpW8USTia6\nuHt34Sac1Arm6F2QUzsdUEUmvGyLIOIGcdb+F6pTdx4ftY+wZi7Aomp4k3vNqXmX\nT0mE0vpQlCmsPUcMHXuUi93XTGPxLXIv9NXxCJZXSYI0JeyuhT9/ithrYlbMlyNc\nwKB/BwSpp+Py2MTT2wIDAQAB\n-----END PUBLIC KEY-----\n";d.dev()&&c.setName(x.productName);var w={},A=0;function I(){return d.windows()?"win":d.macOS()?"mac":r.arch().indexOf("arm")>=0?"arm":"linux"}function S(){return d.dev()?x.version:c.getVersion()}function _(e,n){switch(e){case"appData":return i.join(c.getPath("appData"),c.getName());case"appResource":return d.dev()?i.resolve("data"):i.resolve(c.getAppPath(),"..","..","data");case"appDocuments":return i.join(c.getPath("documents"),c.getName());case"script":return i.join(_("appResource"),"scripts",n+"."+(d.windows()?"bat":"sh"));case"command":return i.join(_("appData"),"temp",""+O(6));case"libraries":return i.join(_("appDocuments"),"libraries");case"packages":return i.join(_("appDocuments"),"packages");case"arduino":return i.join(_("appResource"),"arduino-"+I());default:return c.getPath(e)}}function O(e,n){var t,r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(n=n||o.length,e)for(t=0;t<e;t++)i[t]=o[0|Math.random()*n];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",t=0;t<36;t++)i[t]||(r=0|16*Math.random(),i[t]=o[19==t?3&r|8:r]);return i.join("")}function D(){return parseInt(Date.now()/1e3)}function E(e,n){return n=n||m.defer(),setTimeout(function(){return n.resolve(e)},10),n.promise}function T(e,n,t){var r=m.defer();return n=n||{},t=t||!1,l.debug("execCommand:"+e+", options: "+JSON.stringify(n)+", useSudo: "+t),t?g.exec(e,{name:"kenrobot"},function(e,n,t){if(n=n||"",t=t||"",n=d.windows()?j.decode(Buffer.from(n),"win1252"):n,t=d.windows()?j.decode(Buffer.from(t),"win1252"):t,e)return l.info(e),n&&l.info(n),t&&l.info(t),void r.reject(t||n||e);d.dev()&&n&&l.debug(n),r.resolve(n)}):o.exec(e,n,function(e,n,t){if(n=n||"",t=t||"",n=d.windows()?j.decode(Buffer.from(n),"win1252"):n,t=d.windows()?j.decode(Buffer.from(t),"win1252"):t,e)return l.info(e),n&&l.info(n),t&&l.info(t),void r.reject(t||n||e);d.dev()&&n&&l.debug(n),r.resolve(n)}),r.promise}function R(e,n,t){var r=m.defer(),i=o.spawn(e,n,t),a="",u="";return i.stdout.on("data",function(e){var n=d.windows()?j.decode(e,"win1252"):e.toString();d.dev()&&n&&l.debug(n),a+=n,r.notify({type:"stdout",data:n})}),i.stderr.on("data",function(e){var n=d.windows()?j.decode(e,"win1252"):e.toString();d.dev()&&n&&l.debug(n),u+=n,r.notify({type:"stderr",data:n})}),i.on("close",function(e){0==e?r.resolve(a):r.reject(u)}),r.promise}function N(e,n,t,r){if(!r){var o=m.defer();return v.outputFile(e,n,t,function(e){if(e)return l.info(e),void o.reject(e);o.resolve()}),o.promise}v.outputFileSync(e,n,t)}function k(e,n){var t=m.defer();return(e=e||{}).title="保存",e.defaultPath=e.defaultPath&&i.isAbsolute(e.defaultPath)?e.defaultPath:i.join(_("documents"),e.defaultPath||"untitled"),e.buttonLabel="保存",n=n||p.getAllWindows()[0],f.showSaveDialog(n,e,function(e){e?t.resolve(e):t.reject()}),t.promise}n.exports.getPlatform=I,n.exports.getVersion=S,n.exports.getAppInfo=function(){var e={bit:"x64"===process.arch||process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432")?64:32,arch:process.arch,platform:I(),version:S(),name:c.getName(),buildNumber:x.buildNumber,dev:d.dev()};return d.dev()?(e.ext=i.extname(_("exe")).replace(".",""),e.branch="beta",e.feature="",e.date=D(),e.appBit=e.bit):(e.ext=x.buildInfo.ext,e.branch=x.buildInfo.branch,e.feature=x.buildInfo.feature,e.date=x.buildInfo.date,e.appBit=x.buildInfo.appBit),e},n.exports.getAppPath=_,n.exports.versionCompare=function(e,n){for(var t=/(\d+)\.(\d+)\.(\d+)/,r=t.exec(e),o=t.exec(n),i=[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],a=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])],u=0;u<=2;u++)if(i[u]!=a[u])return i[u]>a[u]?1:-1;return 0},n.exports.postMessage=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];l.debug("postMessage: "+e+", "+t.join(", "));var o=p.getAllWindows();o&&o.length&&o[0].webContents.send(e,t)},n.exports.listenMessage=function(e,n){var t=this,r="app:"+e;s.on(r,function(e,o){for(var i=arguments.length,a=Array(i>2?i-2:0),u=2;u<i;u++)a[u-2]=arguments[u];(n.apply(t,a)||E()).then(function(n){e.sender.send(r,o,!0,n)},function(n){e.sender.send(r,o,!1,n)},function(n){e.sender.send(r,o,"notify",n)})})},n.exports.getDefer=function(){var e=m.defer(),n=A++;return w[n]=e,{deferId:n,promise:e.promise}},n.exports.callDefer=function(e,n){var t=w[e];if(t){var r;"notify"==n?r=t.notify:(delete w[e],r=n?t.resolve:t.reject);for(var o=arguments.length,i=Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];r.apply(this,i)}},n.exports.handleQuotes=function(e){return d.windows()?e:e.replace(/"/g,"")},n.exports.uuid=O,n.exports.stamp=D,n.exports.throttle=function(e,n){var t;return function(){t&&clearTimeout(t),t=setTimeout(function(){e(),clearTimeout(t),t=null},n)}},n.exports.encrypt=function(e,n,t){t=t||"aes-128-cbc";var r=a.createCipher(t,n),o=r.update(e,"utf8","binary");return o+=r.final("binary"),o=new Buffer(o,"binary").toString("base64")},n.exports.decrypt=function(e,n,t){t=t||"aes-128-cbc",e=new Buffer(e,"base64").toString("binary");var r=a.createDecipher(t,n),o=r.update(e,"binary","utf8");return o+=r.final("utf8")},n.exports.rsa_encrypt=function(e,n){n=n||y;var t=new Buffer(e);return a.publicEncrypt({key:n,padding:a.constants.RSA_PKCS1_PADDING},t).toString("base64")},n.exports.rsa_decrypt=function(e,n){var t=new Buffer(e,"base64");return a.privateDecrypt({key:n,padding:a.constants.RSA_PKCS1_PADDING},t).toString("utf8")},n.exports.resolvePromise=E,n.exports.rejectPromise=function(e,n){return n=n||m.defer(),setTimeout(function(){return n.reject(e)},10),n.promise},n.exports.execFile=function(e){var n=m.defer();return l.debug("execFile: "+e),T(d.windows()?"start /WAIT "+e:""+e,null,!0).fin(function(){n.resolve()}),n.promise},n.exports.execCommand=T,n.exports.spawnCommand=R,n.exports.readFile=function(e,n,t){if(t)return v.readFileSync(e,n);var r=m.defer();return n=n||"utf8",v.readFile(e,n,function(e,n){if(e)return l.info(e),void r.reject(e);r.resolve(n)}),r.promise},n.exports.writeFile=N,n.exports.saveFile=function(e,n,t){var r=m.defer();return t=t||{},e&&(t.defaultPath=e),k(t).then(function(e){N(e,n,t).then(function(){r.resolve()},function(e){e&&l.info(e),r.reject(e)})},function(e){e&&l.info(e),r.reject(e)}),r.promise},n.exports.moveFile=function(e,n,t){var r=m.defer();return t=t||{overwrite:!0},v.move(e,n,t,function(e){if(e)return l.info(e),void r.reject(e);r.resolve()}),r.promise},n.exports.removeFile=function(e,n){if(!n){var t=m.defer();return v.remove(e,function(e){if(e)return l.info(e),void t.reject(e);t.resolve()}),t.promise}v.removeSync(e)},n.exports.readJson=function(e,n){var t=m.defer();return n=n||{},v.readJson(e,n,function(e,n){if(e)return l.info(e),void t.reject(e);t.resolve(n)}),t.promise},n.exports.writeJson=function(e,n,t,r){if(!r){var o=m.defer();return t=t||{},v.outputJson(e,n,t,function(e){if(e)return l.info(e),void o.reject(e);o.resolve()}),o.promise}v.outputJsonSync(e,n,t)},n.exports.searchFiles=function(e){var n=m.defer();return l.debug("searchFiles: "+e),h(e).then(function(e){n.resolve(e)},function(e){e&&l.info(e),n.reject(e)}),n.promise},n.exports.compress=function(e,n,t,r){var o=m.defer();return n=n||[n],r=r||"7z",l.debug("compress: "+e+": "+n.length+" => "+t+": "+r),T("cd "+(d.windows()?"/d ":"")+e+' && "'+b+'" a -t'+r+' -r "'+t+'" '+n.join(" ")).then(function(){o.resolve()},function(e){e&&l.info(e),o.reject(e)}),o.promise},n.exports.uncompress=function(e,n,t){var r=m.defer(),o=/([\d]+)% \d+ - .*\r?/g;return l.debug("uncompress: "+e+" => "+n),t?R('"'+b+'"',["x",'"'+e+'"',"-bsp1","-y",'-o"'+n+'"'],{shell:!0}).then(function(e){r.resolve(e)},function(e){e&&l.info(e),r.reject(e)},function(e){if(o.lastIndex=0,o.test(e.data)){var n,t=o.exec(e.data);do{n=t,t=o.exec(e.data)}while(t);r.notify(parseInt(n[1]))}}):T('"'+b+'" x "'+e+'" -y -o"'+n+'"').then(function(){r.resolve()},function(e){e&&l.info(e),r.reject(e)}),r.promise},n.exports.showOpenDialog=function(e,n){var t=m.defer();return(e=e||{}).title="打开",e.defaultPath=e.defaultPath||_("documents"),e.buttonLabel="打开",n=n||p.getAllWindows()[0],f.showOpenDialog(n,e,function(e){e?t.resolve(e[0]):t.reject()}),t.promise},n.exports.showSaveDialog=k,n.exports.request=function(e,n,t){var r=m.defer();if(t=!1!==t,(n=n||{}).method=n.method||"GET",t&&n.data){n.body=JSON.stringify(n.data);var o=n.headers||(n.headers={});o["Content-Type"]="application/json",o.Accept="application/json",delete n.data}return P(e,n).then(function(e){if(e.ok)return t?e.json():e;var n=new Error(e.statusText);throw n.status=e.status,n}).then(function(e){r.resolve(e)}).catch(function(e){e&&l.info(e),r.reject(e)}),r.promise}},{"7zip-bin":void 0,child_process:void 0,crypto:void 0,electron:void 0,"electron-is":void 0,"electron-log":void 0,"fs-extra":void 0,globby:void 0,"iconv-lite":void 0,lodash:void 0,"node-fetch":void 0,os:void 0,path:void 0,q:void 0,"sudo-prompt":void 0}]},{},[5]);