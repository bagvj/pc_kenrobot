"use strict";var _slicedToArray=function(){function e(e,r){var n=[],t=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(t=(a=u.next()).done)&&(n.push(a.value),!r||n.length!==r);t=!0);}catch(e){o=!0,i=e}finally{try{!t&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function e(r,n,t){function o(a,u){if(!n[a]){if(!r[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var f=n[a]={exports:{}};r[a][0].call(f.exports,function(e){var n=r[a][1][e];return o(n||e)},f,f.exports,e,r,n,t)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e,r,n){r.exports={default:{build:{fqbn:"arduino:avr:uno:cpu=atmega328p",prefs:{"runtime.tools.avr-gcc.path":'"ARDUINO_PATH/hardware/tools/avr"',"runtime.tools.avrdude.path":'"ARDUINO_PATH/hardware/tools/avr"',"build.warn_data_percentage":"75"},command:'"ARDUINO_PATH/arduino-builder" -compile -logger=machine -hardware="ARDUINO_PATH/hardware" -hardware="ARDUINO_PATH/packages" -tools="ARDUINO_PATH/tools-builder" -tools="ARDUINO_PATH/hardware/tools/avr" -tools="ARDUINO_PATH/packages" -built-in-libraries="ARDUINO_PATH/libraries" -ide-version=10612 -warnings=none BUILD_SPECS -build-path="PROJECT_BUILD_PATH" "PROJECT_ARDUINO_FILE"'},upload:{target_type:"hex",mcu:"atmega328p",baudrate:"115200",programer:"arduino",command:'"ARDUINO_PATH/hardware/tools/avr/bin/avrdude" -C "ARDUINO_PATH/hardware/tools/avr/etc/avrdude.conf" -v -p ARDUINO_MCU -c ARDUINO_PROGRAMMER -b ARDUINO_BURNRATE -P ARDUINO_COMPORT -D -U "flash:w:TARGET_PATH:i"'}},librariesPath:[]}},{}],2:[function(e,r,n){function t(){xe.transports.file.format="[{y}-{m}-{d} {h}:{i}:{s}] [{level}] {text}",be.dev()&&Ie.dev?xe.transports.file.level="debug":(xe.transports.console=!1,xe.transports.file.level="error")}function o(){ae.on("ready",u).on("window-all-closed",function(){return"darwin"!==process.platform&&ae.quit()}).on("activate",function(){return null===te&&c()}).on("before-quit",s).on("will-quit",f).on("quit",function(){return xe.debug("app quit")})}function i(){a("getAppInfo",function(){return de.resolvePromise(de.getAppInfo())}),a("getBaseUrl",function(){return de.resolvePromise(".")}),a("loadSetting",function(){return x()}),a("saveSetting",function(e){return w(e)}),a("execFile",function(e){return de.execFile(e)}),a("execCommand",function(e,r){return de.execCommand(e,r)}),a("spawnCommand",function(e,r,n){return de.spawnCommand(e,r,n)}),a("readFile",function(e,r){return de.readFile(e,r)}),a("writeFile",function(e,r){return de.writeFile(e,r)}),a("moveFile",function(e,r,n){return de.moveFile(e,r,n)}),a("removeFile",function(e){return de.removeFile(e)}),a("readJson",function(e,r){return de.readJson(e,r)}),a("writeJson",function(e,r,n,t){return de.writeJson(e,r,n,t)}),a("showOpenDialog",function(e){return de.showOpenDialog(e)}),a("showSaveDialog",function(e){return de.showSaveDialog(e)}),a("request",function(e,r,n){return de.request(e,r,n)}),a("showItemInFolder",function(e){return se.showItemInFolder(pe.normalize(e))}),a("openUrl",function(e){return de.resolvePromise(e&&se.openExternal(e))}),a("listSerialPort",function(){return B()}),a("openSerialPort",function(e,r){return E(e,r)}),a("writeSerialPort",function(e,r){return me.writeSerialPort(e,r)}),a("closeSerialPort",function(e){return me.closeSerialPort(e)}),a("updateSerialPort",function(e,r){return me.updateSerialPort(e,r)}),a("flushSerialPort",function(e){return me.flushSerialPort(e)}),a("buildProject",function(e,r){return M(e,r)}),a("upload",function(e,r){return H(e,r)}),a("upload2",function(e,r,n){return G(e,r,n)}),a("download",function(e,r){return k(e,r)}),a("installDriver",function(e){return U(e)}),a("loadExamples",function(){return _()}),a("openExample",function(e,r,n){return I(e,r,n)}),a("unzipPackages",function(e){return P(e)}),a("unzipPackage",function(e){return S(e)}),a("loadPackages",function(){return A()}),a("deletePackage",function(e){return D(e)}),a("getInstalledLibraries",function(){return O()}),a("loadLibraries",function(){return T()}),a("unzipLibrary",function(e,r){return N(e,r)}),a("deleteLibrary",function(e){return R(e)}),a("checkUpdate",function(e){return g(e)}),a("removeOldVersions",function(e){return j(e)}),a("reportToServer",function(e,r){return h(e,r)}),a("setToken",function(e){return ve.set(e)}),a("saveToken",function(e){return ve.save(e)}),a("loadToken",function(e){return ve.load(e)}),a("removeToken",function(){return ve.remove()}),a("projectRead",function(e){return he.read(e)}),a("projectSave",function(e,r,n){return he.save(e,r,n)}),a("projectOpen",function(e){return he.open(e)}),a("projectNewSave",function(e,r,n,t){return he.newSave(e,r,n,t)}),a("projectNewSaveAs",function(e,r,n){return he.newSaveAs(e,r,n)}),a("projectNewOpen",function(e,r){return he.newOpen(e,r)}),a("projectSyncUrl",function(e){return he.setSyncUrl(e)}),a("projectSync",function(){return he.sync()}),a("projectList",function(e){return he.list(e)}),a("projectUpload",function(e,r){return he.upload(e,r)}),a("projectDelete",function(e,r){return he.remove(e,r)}),a("projectDownload",function(e,r){return he.download(e,r)}),a("log",function(e,r){return(xe[r]||xe.debug).bind(xe).call(e)}),a("copy",function(e,r){return fe.writeText(e,r)}),a("quit",function(){return ae.quit()}),a("exit",function(){return ae.exit(0)}),a("reload",function(){return te.reload()}),a("relaunch",function(){return l()}),a("fullscreen",function(){return te.setFullScreen(!te.isFullScreen())}),a("min",function(){return te.minimize()}),a("max",function(){return p()}),a("errorReport",function(e){return d(e)})}function a(e,r){var n=this,t="app:"+e;ce.on(t,function(e,o){for(var i=arguments.length,a=Array(i>2?i-2:0),u=2;u<i;u++)a[u-2]=arguments[u];(r.apply(n,a)||de.resolvePromise()).then(function(r){e.sender.send(t,o,!0,r)},function(r){e.sender.send(t,o,!1,r)},function(r){e.sender.send(t,o,"notify",r)})})}function u(){xe.debug("app ready"),be.dev()&&Ie.devTool&&ye({showDevTools:!0}),b().then(function(e){ne=e,c(),X(),v(),m()})}function c(){te=new ue({width:1200,height:720,minWidth:1200,minHeight:720,frame:!1,show:!1,webPreferences:{plugins:!0,webSecurity:!1}}),Ie.fullscreen?te.setFullScreen(!0):Ie.maximize&&te.maximize(),te.on("closed",function(){return te=null}).once("ready-to-show",function(){return te.show()}).on("enter-full-screen",function(){return de.postMessage("app:onFullscreenChange",!0)}).on("leave-full-screen",function(){return de.postMessage("app:onFullscreenChange",!1)}),te.webContents.on("devtools-reload-page",function(){return me.closeAllSerialPort()}),te.webContents.session.on("will-download",F),te.loadURL("file://"+__dirname+"/../renderer/index.html"),te.focus()}function s(e){e.preventDefault(),de.postMessage("app:onBeforeQuit")}function f(e){me.closeAllSerialPort(),de.removeFile(pe.join(de.getAppDataPath(),"temp"),!0)}function p(){te.isFullScreen()?te.setFullScreen(!1):te.isMaximized()?te.unmaximize():te.maximize()}function l(){ae.relaunch({args:process.argv.slice(1).concat(["--relaunch"])}),ae.exit(0)}function d(e){xe.error("------ error message ------"),xe.error(e.message+"("+e.src+" at line "+e.line+":"+e.col+")"),xe.error(""+e.stack)}function v(){be.dev()||ne.version==de.getVersion()||(ne.version=de.getVersion(),ne.reportInstall=!1,oe=!0,y(!0))}function m(){be.dev()||ne.reportInstall||h(null,"installations").then(function(){ne.reportInstall=!0,y()}),h(null,"open")}function h(e,r){var n=we.defer(),t=de.getAppInfo(),o={version:t.version,platform:t.platform,bit:t.appBit,ext:t.ext,branch:t.branch,feature:t.feature};e=De.merge({},e,o),r=r||"log";return de.request("http://userver.kenrobot.com/statistics/report",{method:"post",data:{data:JSON.stringify(e),type:r}}).then(function(){n.resolve()},function(t){xe.error("report error: type: "+r+", "+JSON.stringify(e)),t&&xe.error(t),n.reject(t)}),n.promise}function g(e){var r=we.defer(),n=de.getAppInfo(),t=e+"&appname="+n.name+"&release_version="+n.branch+"&version="+n.version+"&platform="+n.platform+"&arch="+n.arch+"&ext="+n.ext+"&features="+n.feature;return xe.debug("checkUpdate: "+t),de.request(t).then(function(e){r.resolve(e)},function(e){e&&xe.error(e),r.reject(e)}),r.promise}function j(e){var r=we.defer();if(be.dev())return setTimeout(function(){r.resolve()},10),r.promise;var n=de.getAppInfo(),t=pe.join(de.getAppDataPath(),"download");return de.searchFiles(t+"/"+n.name+"-*."+n.ext).then(function(n){var o=/\d+\.\d+\.\d+/;n.map(function(e){return pe.basename(e)}).filter(function(r){var n=r.match(o);return!!n&&de.versionCompare(n[0],e)<0}).forEach(function(e){de.removeFile(pe.join(t,e),!0)}),r.resolve()},function(e){e&&xe.error(e),r.reject(e)}),r.promise}function b(){var e=we.defer();xe.debug("loadConfig");var r=pe.join(de.getAppDataPath(),"config.json");return Pe.existsSync(r)?(de.readJson(r).then(function(r){e.resolve(r)},function(r){e.resolve({})}),e.promise):(setTimeout(function(){e.resolve({})},10),e.promise)}function y(e){var r=pe.join(de.getAppDataPath(),"config.json");return de.writeJson(r,ne,null,e)}function x(){return de.resolvePromise(ne.setting||{})}function w(e){return ne.setting=e,y()}function P(e){var r=we.defer();if(e=e||be.dev())return xe.debug("skip unzip packages"),setTimeout(function(){r.resolve()},10),r.promise;xe.debug("unzip packages");var n=pe.join(de.getAppResourcePath(),"packages");return de.readJson(pe.join(n,"packages.json")).then(function(e){var t=ne.packages||[],o=e.filter(function(e){return!!oe||(!!t.find(function(r){return r.name==e.name&&r.checksum!=e.checksum})||!Pe.existsSync(pe.join(ee(),e.name,"package.json")))}),i=o.length;!function e(){if(0==o.length)return ne.packages=t,void(be.dev()?r.resolve():y().fin(function(){r.resolve()}));var a=o.pop();de.unzip(pe.join(n,a.archiveName),ee(),!0).then(function(){var e=t.findIndex(function(e){return e.name==a.name});e>=0?t.splice(e,1,a):t.push(a)},function(e){},function(e){r.notify({progress:e,name:a.name,version:a.version,count:i-o.length,total:i})}).fin(function(){return e()})}()},function(e){e&&xe.error(e),r.resolve()}),r.promise}function S(e){var r=we.defer();return de.unzip(e,ee(),!0).then(function(){var n=pe.basename(e);n=n.substring(0,n.indexOf("-"));var t=be.windows()?"bat":"sh";de.searchFiles(pe.join(ee(),n)+"/**/post_install."+t).then(function(e){if(0!=e.length){var n=e[0];de.execCommand('"'+n+'"',{cwd:pe.dirname(n)}).then(function(){r.resolve()},function(e){e&&xe.error(e),r.reject(e)})}else r.resolve()},function(e){e&&xe.error(e),r.reject(e)})},function(e){e&&xe.error(e),r.reject(e)},function(e){r.notify(e)}),r.promise}function A(){var e=we.defer(),r=[],n=ee();return xe.debug("loadPackages: "+n),de.searchFiles(n+"/*/package.json").then(function(t){we.all(t.map(function(e){var t=we.defer();return de.readJson(e).then(function(t){t.order=ge[t.name]||0,t.path=pe.dirname(e),t.protocol=n.startsWith("/")?"file://":"file:///",t.boards&&t.boards.forEach(function(e){e.build&&e.build.prefs&&Object.keys(e.build.prefs).forEach(function(r){e.build.prefs[r]=e.build.prefs[r].replace("PACKAGE_PATH",t.path)}),e.upload&&e.upload.command&&(e.upload.command=e.upload.command.replace(/PACKAGE_PATH/g,t.path))});var o=pe.join(t.path,"src");Pe.existsSync(o)&&!je.librariesPath.includes(o)&&je.librariesPath.push(o),r.push(t)}).fin(function(){t.resolve()}),t.promise})).then(function(){e.resolve(r)})},function(r){r&&xe.error(r),e.reject(r)}),e.promise}function D(e){var r=we.defer();return xe.debug("deletePackage: "+e),de.removeFile(pe.join(ee(),e)).then(function(){r.resolve()},function(e){e&&xe.error(e),r.reject(e)}),r.promise}function I(e,r,n){var t,o=we.defer();return t="built-in"==(n=n||"built-in")?pe.join(de.getAppResourcePath(),"examples",e,r):pe.join(ee(),n,"examples",e,r),xe.debug("openExample: "+t),de.readJson(pe.join(t,"project.json")).then(function(e){o.resolve(e)},function(e){e&&xe.error(e),o.reject(e)}),o.promise}function _(){var e=we.defer(),r=[];return xe.debug("loadExamples"),de.readJson(pe.join(de.getAppResourcePath(),"examples","examples.json")).then(function(n){r.push({name:"built-in",groups:n});var t=ee();de.searchFiles(t+"/*/examples/examples.json").then(function(n){we.all(n.map(function(e){var n=we.defer();return de.readJson(e).then(function(n){r.push({name:pe.basename(pe.dirname(pe.dirname(e))),groups:n})}).fin(function(){n.resolve()}),n.promise})).then(function(){e.resolve(r)})},function(r){r&&xe.error(r),e.reject(r)})},function(r){r&&xe.error(r),e.reject(r)}),e.promise}function O(){var e=we.defer(),r=/^([^=]+)=(.*)$/gm;return de.searchFiles(re()+"/**/library.properties").then(function(n){var t=[];we.all(n.map(function(e){var n=we.defer();return de.readFile(e).then(function(e){var n=e.match(r);if(!(n.length<0)){var o={};n.map(function(e){return e.split("=")}).forEach(function(e){o[e[0]]=e[1]}),o.name&&o.version&&t.push(o)}}).fin(function(){n.resolve()}),n.promise})).then(function(){e.resolve(t)})},function(r){r&&xe.error(r),e.reject(r)}),e.promise}function T(){var e=we.defer();return de.readJson(pe.join(de.getAppResourcePath(),"libraries","libraries.json")).then(function(r){e.resolve(r.libraries)},function(r){r&&xe.error(r),e.reject(r)}),e.promise}function N(e,r){var n=we.defer(),t=re(),o=pe.basename(r,pe.extname(r));return de.unzip(r,t,!0).then(function(){de.moveFile(pe.join(t,o),pe.join(t,e)).then(function(){n.resolve()},function(e){e&&xe.error(e),n.reject(e)})},function(e){e&&xe.error(e),n.reject(e)},function(e){n.notify(e)}),n.promise}function R(e){var r=we.defer();return xe.debug("deleteLibrary: "+e),de.removeFile(pe.join(re(),e)).then(function(){r.resolve()},function(e){e&&xe.error(e),r.reject(e)}),r.promise}function F(e,r,n){var t=r.getURL(),o=t.lastIndexOf("#"),i=le.parse(t.substring(o+1));t=t.substring(0,o);var a=i.deferId,u=pe.join(de.getAppDataPath(),"download",r.getFilename());if(i.checksum&&Pe.existsSync(u)){o=i.checksum.indexOf(":");var c=i.checksum.substring(0,o).replace("-","").toLowerCase();if(i.checksum.substring(o+1)==Ae.fromFileSync(u,{algorithm:c}))return r.cancel(),xe.debug("download cancel, "+t+" has cache"),void de.callDefer(a,!0,{path:u})}r.setSavePath(u);var s=r.getTotalBytes();r.on("updated",function(e,n){"interrupted"==n?(xe.debug("download interrupted: "+t),de.callDefer(a,!1,{path:u})):"progressing"===n&&(r.isPaused()?(xe.debug("download paused: "+t),de.callDefer(a,!1,{path:u})):de.callDefer(a,"notify",{path:u,totalSize:s,size:r.getReceivedBytes()}))}),r.once("done",function(e,r){"completed"==r?(xe.debug("download success: "+t+", at "+u),de.callDefer(a,!0,{path:u})):(xe.debug("download fail: "+t),de.callDefer(a,!1,{path:u}))})}function k(e,r){var n=we.defer(),t=de.getDefer(),o=t.deferId,i=t.promise;r.deferId=o;var a=le.stringify(r);return xe.debug("download "+e+", options: "+a),i.then(function(e){n.resolve(e)},function(e){e&&xe.error(e),n.reject(e)},function(e){n.notify(e)}),te.webContents.downloadURL(e+"#"+a),n.promise}function U(e){var r=we.defer();xe.debug("installDriver: "+e);var n=pe.join(de.getAppDataPath(),"temp");return de.unzip(e,n).then(function(){var t=pe.join(n,pe.basename(e,pe.extname(e)),"setup.exe");de.execFile(t).then(function(){r.resolve()})},function(e){e&&xe.error(e),r.reject(e)}),r.promise}function E(e,r){return me.openSerialPort(e,r,{onError:C,onData:q,onClose:J})}function C(e,r){de.postMessage("app:onSerialPortError",e,r)}function q(e,r){de.postMessage("app:onSerialPortData",e,r)}function J(e){de.postMessage("app:onSerialPortClose",e)}function B(){var e=we.defer();return me.listSerialPort().then(function(r){0!=(r=z(r)).length?V(r).then(function(){xe.debug(r.map(function(e){return e.comName+", pid: "+e.productId+", vid: "+e.vendorId+", boardName: "+(e.boardName||"")}).join("\n")),e.resolve(r)},function(r){r&&xe.error(r),e.reject(r)}):e.reject()},function(r){r&&xe.error(r),e.reject(r)}),e.promise}function z(e){var r=/(COM\d+)|(usb-serial)|(arduino)|(\/dev\/cu\.usbmodem)|(\/dev\/tty\.)|(\/dev\/(ttyUSB|ttyACM|ttyAMA))/;return e.filter(function(e){return r.test(e.comName)})}function M(e,r){var n=we.defer();return L(e,r).then(function(r){xe.debug("buildProject: "+e+", command path: "+r);var t=Y("call");de.spawnCommand('"'+t+'"',['"'+r+'"'],{shell:!0}).then(function(){n.resolve()},function(e){e&&xe.error(e),n.reject(e)},function(e){n.notify(e)})},function(e){e&&xe.error(e),n.reject(e)}),n.promise}function L(e,r){var n=we.defer();xe.debug("pre-build");var t=[];r=De.merge({},je.default.build,r);var o=ee();Pe.existsSync(o)&&t.push("-hardware="+o),t.push("-fqbn="+r.fqbn);var i=$();Object.keys(r.prefs).forEach(function(e){var n=de.handleQuotes(r.prefs[e]);n=n.replace(/ARDUINO_PATH/g,i),t.push("-prefs="+e+"="+n)});var a=re();Pe.existsSync(a)&&t.push('-libraries="'+a+'"'),je.librariesPath.forEach(function(e){t.push('-libraries="'+e+'"')});var u=pe.join(e,"build");Pe.ensureDirSync(u),de.removeFile(pe.join(u,"sketch","build"),!0);var c=Z("build"),s=de.handleQuotes(r.command);return s=s.replace(/ARDUINO_PATH/g,$()).replace("BUILD_SPECS",t.join(" ")).replace("PROJECT_BUILD_PATH",u).replace("PROJECT_ARDUINO_FILE",pe.join(e,pe.basename(e)+".ino")),de.writeFile(c,s).then(function(){var t=pe.join(e,"build","build.options.json");if(!Pe.existsSync(t))return setTimeout(function(){n.resolve(c)},10),n.promise;de.readJson(t).then(function(t){r.fqbn!=t.fqbn?de.removeFile(pe.join(e,"build")).fin(function(){Pe.ensureDirSync(pe.join(e,"build")),n.resolve(c)}):n.resolve(c)},function(e){e&&xe.error(e),n.resolve(c)})},function(e){e&&xe.error(e),n.reject()}),n.promise}function H(e,r){return r=De.merge({},je.default.upload,r),K(pe.join(e,"build",pe.basename(e)+".ino."+r.target_type),r)}function G(e,r,n){return n=De.merge({},je.default.upload,n),W(pe.join(e,"build",pe.basename(e)+".ino."+n.target_type),r,n)}function K(e,r){var n=we.defer();return B().then(function(t){1==t.length?W(e,t[0].comName,r).then(function(e){n.resolve(e)},function(e){n.reject(e)},function(e){n.notify(e)}):n.reject({status:"SELECT_PORT",ports:t})},function(){n.reject({status:"NOT_FOUND_PORT"})}),n.promise}function W(e,r,n){var t=we.defer();return Q(e,r,n).then(function(n){xe.debug("upload firmware: "+e+", "+r+", command path: "+n);var o=Y("call");de.spawnCommand('"'+o+'"',['"'+n+'"'],{shell:!0}).then(function(){t.resolve()},function(e){e&&xe.error(e),t.reject(e)},function(e){t.notify(e)})},function(e){e&&xe.error(e),t.reject(e)}),t.promise}function Q(e,r,n){var t=we.defer();xe.debug("pre upload firmware"),n=De.merge({},je.default.upload,n);var o=Z("upload"),i=de.handleQuotes(n.command);return i=i.replace(/ARDUINO_PATH/g,$()).replace("ARDUINO_MCU",n.mcu).replace("ARDUINO_BURNRATE",n.baudrate).replace("ARDUINO_PROGRAMMER",n.programer).replace("ARDUINO_COMPORT",r).replace("TARGET_PATH",e),de.writeFile(o,i).then(function(){me.resetSerialPort(r).then(function(){t.resolve(o)},function(e){e&&xe.error(e),t.reject(e)})},function(e){e&&xe.error(e),t.reject(e)}),t.promise}function X(e){var r=we.defer();if(ne.boardNames&&!e)return xe.debug("skip loadBoards"),setTimeout(function(){r.resolve(ne.boardNames)},10),r.promise;xe.debug("loadBoards");var n={},t=/\n(([^\.\n]+)\.pid(\.\d)?)=([^\r\n]+)/g,o=/\n(([^\.\n]+)\.vid(\.\d)?)=([^\r\n]+)/g,i=/\n([^\.\n]+)\.name=([^\r\n]+)/g,a="arduino-"+de.getPlatform();return de.searchFiles(a+"/**/boards.txt").then(function(e){we.all(e.map(function(e){var r=we.defer();return de.readFile(e).then(function(e){var r=e.match(t),a=e.match(o),u=[];e.match(i).forEach(function(e){var r=e.substring(0,e.indexOf(".name")).trim(),n=e.substring(e.indexOf("=")+1).trim();u[r]=n});var c=r.map(function(e){return e.substring(0,e.indexOf(".pid")).trim()});r=r.map(function(e){return e.substring(e.indexOf("=")+3)}),a=a.map(function(e){return e.substring(e.indexOf("=")+3)}),r.forEach(function(e,r){n[e+"_"+a[r]]={pid:e,vid:a[r],type:c[r],name:u[c[r]]}})}).fin(function(){r.resolve()}),r.promise})).then(function(){ne.boardNames=n,y().then(function(){r.resolve(ne.boardNames)},function(e){e&&xe.error(e),r.reject(e)})})},function(e){e&&xe.error(e),r.reject(e)}),r.promise}function V(e){var r=we.defer();return xe.debug("matchBoardNames"),X().then(function(n){e.forEach(function(e){if(e.productId&&e.vendorId){var r=ne.boardNames[e.productId+"_"+e.vendorId];r&&(e.boardName=r.name)}}),r.resolve(e)},function(e){e&&xe.error(e),r.reject(e)}),r.promise}function Y(e){var r=be.windows()?"bat":"sh";return pe.join(de.getAppResourcePath(),"scripts",e+"."+r)}function Z(e){return pe.join(de.getAppDataPath(),"temp",e+".txt")}function $(){return pe.join(de.getAppResourcePath(),"arduino-"+de.getPlatform())}function ee(){return pe.join(ae.getPath("documents"),ae.getName(),"packages")}function re(){return pe.join(ae.getPath("documents"),ae.getName(),"libraries")}var ne,te,oe,ie=e("electron"),ae=ie.app,ue=ie.BrowserWindow,ce=ie.ipcMain,se=ie.shell,fe=ie.clipboard,pe=(ie.webContents,e("path")),le=(e("os"),e("querystring")),de=(e("crypto"),e("./util")),ve=e("./token"),me=e("./serialPort"),he=e("./project"),ge=e("./packageOrders"),je=e("./arduinoOptions"),be=e("electron-is"),ye=e("electron-debug"),xe=e("electron-log"),we=e("q"),Pe=e("fs-extra"),Se=e("minimist"),Ae=e("hasha"),De=e("lodash"),Ie=Se(process.argv.slice(1));process.on("uncaughtException",function(e){var r=e.stack||e.name+": "+e.message;xe.error(r),ae.quit()}),t(),ae.makeSingleInstance(function(e,r){te&&(te.isMinimized()&&te.restore(),te.focus())})&&ae.quit(),o(),i(),xe.debug("app "+ae.getName()+" start, version "+de.getVersion())},{"./arduinoOptions":1,"./packageOrders":3,"./project":4,"./serialPort":5,"./token":6,"./util":7,crypto:void 0,electron:void 0,"electron-debug":void 0,"electron-is":void 0,"electron-log":void 0,"fs-extra":void 0,hasha:void 0,lodash:void 0,minimist:void 0,os:void 0,path:void 0,q:void 0,querystring:void 0}],3:[function(e,r,n){r.exports={UperEnergy:100,Intel:101,KenBlock:102}},{}],4:[function(e,r,n){function t(e){var r=_.defer();e=e||"all",T.debug("project list: "+e);var n=F.get();if(!n||!A)return R.rejectPromise(null,r);var t=n.user_id,o=R.stamp(),i=R.rsa_encrypt("Kenrobot-"+t+"-"+o),a=A+"/list";return R.request(a,{method:"post",data:{id:t,stamp:o,sign:i,type:e}}).then(function(e){0==e.status?r.resolve(e.data):r.reject(e.message)},function(e){e&&T.error(e),r.reject(e)}),r.promise}function o(e,r){var n=_.defer();T.debug("project upload: "+e+" "+r);var t=F.get();if(!t||!A)return R.rejectPromise(null,n);var o=t.user_id,i=R.stamp(),a=R.rsa_encrypt("Kenrobot-"+o+"-"+i);return u(b(o,r),e,r).then(function(t){var u=A+"/upload";R.request(u,{method:"post",headers:{id:o,stamp:i,sign:a,name:encodeURI(e),type:r},body:I.createReadStream(t)}).then(function(t){if(0==t.status){var o=t.data;v(o.name,o.type,o.modify_time).then(function(){T.debug("project upload success: "+e+" "+r),n.resolve(o)},function(e){e&&T.error(e),n.reject(e)})}else n.reject(t.message)},function(e){e&&T.error(e),n.reject(e)})},function(e){e&&T.error(e),n.reject(e)}),n.promise}function i(e,r){var n=_.defer();T.debug("project download: "+e+" "+r);var t=F.get();if(!t||!A)return R.rejectPromise(null,n);var o=t.user_id,i=R.stamp(),a=R.rsa_encrypt("Kenrobot-"+o+"-"+i),u={id:o,stamp:i,sign:a,name:e,type:r},s=A+"/download";return R.request(s,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)},!1).then(function(t){var i=parseInt(t.headers.get("modify_time")),a=D.join(R.getAppDataPath(),"temp",R.uuid(6)+".zip");I.ensureDirSync(D.dirname(a));var u=I.createWriteStream(a);t.body.pipe(u),t.body.on("end",function(){c(a,b(o,r),e,r).then(function(){v(e,r,i).then(function(){T.debug("project download success: "+e+" "+r),n.resolve()},function(e){e&&T.error(e),n.reject(e)})},function(e){e&&T.error(e),n.reject(e)})}).on("error",function(e){e&&T.error(e),n.reject(e)})},function(e){e&&T.error(e),n.reject(e)}),n.promise}function a(){var e=_.defer();return T.debug("project sync"),_.all([t(),h()]).then(function(r){var n=_slicedToArray(r,2);f(n[0],n[1]).then(function(){T.debug("project sync success"),e.resolve()},function(r){T.debug("project sync fail"),r&&T.error(r),e.reject(r)},function(r){e.notify(r)})},function(r){r&&T.error(r),e.reject(r)}),e.promise}function u(e,r,n){var t=_.defer(),o=new N;o.file(r+"/"+r+".ino",I.createReadStream(D.join(e,r+"/"+r+".ino"))),o.file(r+"/project.json",I.createReadStream(D.join(e,r+"/project.json")));var i=D.join(R.getAppDataPath(),"temp",R.uuid(6)+".zip");return I.ensureDirSync(D.dirname(i)),o.generateNodeStream({streamFiles:!0,type:"nodebuffer"}).pipe(I.createWriteStream(i)).on("finish",function(){t.resolve(i)}).on("error",function(e){e&&T.error(e),t.reject(e)}),t.promise}function c(e,r,n,t){var o=_.defer();return R.unzip(e,r).then(function(){T.error("unzip success: "+n+" "+t),o.resolve()},function(e){e&&T.error(e),o.reject(e)}),o.promise}function s(e,r){var n=F.get();if(!n)return!1;var t=b(n.user_id,r),o=D.join(t,e);return I.existsSync(o)}function f(e,r){var n=_.defer(),t=p(e,r),o=_slicedToArray(t,2),i=o[0],a=o[1];T.debug("doSync: downloadList:"+i.length+", uploadList:"+a.length);var u=i.length+a.length,c=0,s=function(e,r,t){c++,n.notify({total:u,count:c,name:e,type:r,action:t})};return l(i,s).then(d(a,s)).then(function(){n.resolve()}).catch(function(e){e&&T.error(e),n.reject(e)}),n.promise}function p(e,r){var n={},t={};e.forEach(function(e){n[e.name+"-"+e.type]=e}),r.forEach(function(e){t[e.name+"-"+e.type]=e});var o=[],i=[];return e.forEach(function(e){var r=e.name+"-"+e.type,n=t[r];!n||!n.modify_time||n.modify_time<e.modify_time?o.push(e):s(e.name,e.type)||o.push(e)}),r.forEach(function(e){var r=e.name+"-"+e.type,t=n[r];(!t||t.modify_time<e.modify_time)&&i.push(e)}),[o,i]}function l(e,r){var n,t=_.defer();return(n=function(){if(0==e.length)return R.resolvePromise(!0,t);var o=e.shift();i(o.name,o.type).then(function(){r(o.name,o.type,"download"),0==e.length?t.resolve():setTimeout(function(){return n()},100)},function(e){e&&T.error(e),t.reject(e)})})(),t.promise}function d(e,r){var n,t=_.defer();return(n=function(){if(0==e.length)return R.resolvePromise(!0,t);var i=e.shift();o(i.name,i.type).then(function(){r(i.name,i.type,"upload"),0==e.length?t.resolve():setTimeout(function(){return n()},100)},function(e){e&&T.error(e),t.reject(e)})})(),t.promise}function v(e,r,n){var t=_.defer();return h().then(function(o){var i=o.find(function(r){return r.name==e});i?i.modify_time=n:o.push({name:e,type:r,modify_time:n}),g(o).then(function(){t.resolve()},function(e){e&&T.error(e),t.reject(e)})},function(e){e&&T.error(e),t.reject(e)}),t.promise}function m(e){var r=_.defer();return h().then(function(n){var t=n.findIndex(function(r){return r.name==e});t<0?r.resolve():(n.splice(t,1),g(n).then(function(){r.resolve()},function(e){e&&T.error(e),r.reject(e)}))},function(e){e&&T.error(e),r.reject(e)}),r.promise}function h(){var e=_.defer(),r=F.get();if(!r)return R.rejectPromise(null,e);var n=j(r.user_id);return I.existsSync(n)?R.readJson(n):R.resolvePromise([],e)}function g(e){var r=F.get();return r?R.writeJson(j(r.user_id),e):R.rejectPromise()}function j(e){return D.join(R.getAppDataPath(),"projects",y(e,1),"list.json")}function b(e,r){return D.join(R.getAppDocumentPath(),"projects",y(e),r)}function y(e,r){return r=r||0,O(""+e,{algorithm:"md5"}).substring(8*r,8*(r+1))}function x(e,r,n,t){var o=_.defer(),i=function(t){w(e,r,n,t).then(function(){o.resolve({name:e,type:r,path:t,tag:"local"})},function(e){e&&T.error(e),o.reject(e)})};if(t)i(t);else{var a={};a.defaultPath=D.join(R.getAppPath("documents"),e),R.showSaveDialog(a).then(function(e){i(e)},function(e){e&&T.error(e),o.reject(e)})}return o.promise}function w(e,r,n,t){return T.debug("project save: "+e+" "+r+" -> "+t),_.all([R.writeFile(D.join(t,e+".ino"),n.project_data.code),R.writeJson(D.join(t,"project.json"),n)])}function P(e,r){var n=_.defer();return T.debug("project open: "+r+" -> "+e),R.readJson(D.join(e,"project.json")).then(function(t){n.resolve({extra:{name:D.basename(e),type:r,path:e},data:t})},function(e){e&&T.error(e),n.reject(e)}),n.promise}function S(e){var r=_.defer();return R.readJson(D.join(e,"project.json")).then(function(n){r.resolve({path:e,projectInfo:n})},function(e){e&&T.error(e),r.reject(e)}),r.promise}var A,D=e("path"),I=e("fs-extra"),_=e("q"),O=e("hasha"),T=e("electron-log"),N=e("jszip"),R=e("./util"),F=e("./token"),k=R.throttle(a,3e3);r.exports.setSyncUrl=function(e){T.debug("project setSyncUrl: "+e),A=e},r.exports.sync=a,r.exports.list=t,r.exports.upload=o,r.exports.remove=function(e,r){var n=_.defer();T.debug("project remove: "+e+" "+r);var t=F.get();if(!t||!A)return R.rejectPromise(null,n);var o=t.user_id,i=R.stamp(),a=R.rsa_encrypt("Kenrobot-"+o+"-"+i),u=A+"/delete";return R.request(u,{method:"post",data:{id:o,stamp:i,sign:a,name:e,type:r}}).then(function(t){0==t.status?_.all([R.removeFile(D.join(b(o,r),e)),m(e)]).then(function(){T.debug("project remove success: "+e+" "+r),n.resolve()},function(e){e&&T.error(e),n.reject(e)}):n.reject(t.message)},function(e){e&&T.error(e),n.reject(e)}),n.promise},r.exports.download=i,r.exports.read=S,r.exports.open=function(e){var r=_.defer(),n=function(e){S(e).then(function(e){r.resolve(e)},function(e){r.reject(e)})};return T.debug("openProject "+e),e?n(e):R.showOpenDialog({properties:["openDirectory"]}).then(function(e){n(e)},function(e){e&&T.error(e),r.reject(e)}),r.promise},r.exports.save=function(e,r,n){var t=_.defer();n=!0===n,T.debug("saveProject: isTemp:"+n);var o=function(e){var n=new Date;r.updated_at=n,r.project_name=D.basename(e),_.all([R.writeFile(D.join(e,D.basename(e)+".ino"),r.project_data.code),R.writeJson(D.join(e,"project.json"),r)]).then(function(){t.resolve({path:e,updated_at:r.updated_at,project_name:r.project_name})},function(){t.reject()})};if(e)o(e);else if(n){var i=D.join(R.getAppPath("temp"),"build","sketch"+(new Date).getTime());o(i)}else R.showSaveDialog().then(function(e){o(e)},function(){t.reject()});return t.promise},r.exports.newSave=function(e,r,n,t){var o=_.defer(),i=F.get();if(!i){var a=D.join(R.getAppDocumentPath(),"projects");return t&&t.startsWith(a)&&(t=null),x(e,r,n,t)}var u=b(i.user_id,r);return t=D.join(u,e),w(e,r,n,t).then(function(){v(e,r,R.stamp()).then(function(){k(),o.resolve({name:e,type:r,path:t,tag:"network"})},function(e){e&&T.error(e),o.reject(e)})},function(e){e&&T.error(e),o.reject(e)}),o.promise},r.exports.newSaveAs=x,r.exports.newOpen=function(e,r){var n=_.defer();T.debug("project open: "+e);var t=function(r){P(r,e).then(function(e){n.resolve(e)},function(e){e&&T.error(e),n.reject(e)})},o=F.get();if(r){if(!o)return R.rejectPromise(null,n);var i=D.join(b(o.user_id,e),r);return t(i),n.promise}var a={};return a.defaultPath=o?b(o.user_id,e):R.getAppPath("documents"),a.properties=["openDirectory"],R.showOpenDialog(a).then(function(e){t(e)},function(e){e&&T.error(e),n.reject(e)}),n.promise}},{"./token":6,"./util":7,"electron-log":void 0,"fs-extra":void 0,hasha:void 0,jszip:void 0,path:void 0,q:void 0}],5:[function(e,r,n){e("path");var t=e("electron-log"),o=e("q"),i=e("serialport"),a=i.parsers.Delimiter,u={autoPortId:0,ports:{}};r.exports.listSerialPort=function(){var e=o.defer();return t.debug("listSerialPort"),i.list(function(r,n){if(r)return t.error(r),void e.reject(r);0!=n.length?e.resolve(n):e.reject()}),e.promise},r.exports.openSerialPort=function(e,r,n){var c=o.defer();t.debug("openSerialPort: "+e+", options: "+JSON.stringify(r)),r.autoOpen=!1;var s=new i(e,r);return s.open(function(e){if(e)return t.error(e),void c.reject(e);var o=++u.autoPortId;u.ports[o]=s,s.on("error",function(e){n&&n.onError&&n.onError(o,e)}),s.on("close",function(){delete u.ports[o],n&&n.onClose&&n.onClose(o)});var i="raw"==r.parser?s:s.pipe(new a({delimiter:Buffer.from(r.parser)}));i.on("readable",function(){var e=i.read();e&&n&&n.onData&&n.onData(o,e)}),s.flush(function(){c.resolve(o)})}),c.promise},r.exports.writeSerialPort=function(e,r){var n=o.defer();t.debug("writeSerialPort: "+e+", "+r);var i=u.ports[e];return i?(i.write(Buffer.from(r),function(e){if(e)return t.error(e),void n.reject(e);i.drain(function(){n.resolve()})}),n.promise):(setTimeout(function(){n.reject()},10),n.promise)},r.exports.closeSerialPort=function(e){var r=o.defer();t.debug("closeSerialPort, portId: "+e);var n=u.ports[e];return n?(n.close(function(){r.resolve()}),r.promise):(setTimeout(function(){r.reject()},10),r.promise)},r.exports.closeAllSerialPort=function(){t.debug("closeAllSerialPort");for(var e in u.ports)u.ports[e].close();u.ports={}},r.exports.updateSerialPort=function(e,r){var n=o.defer();t.debug("updateSerialPort, portId: "+e);var i=u.ports[e];return i?(i.update(r,function(){n.resolve()}),n.promise):(setTimeout(function(){n.reject()},10),n.promise)},r.exports.flushSerialPort=function(e,r){var n=o.defer();t.debug("flushSerialPort, portId: "+e);var i=u.ports[e];return i?(i.flush(function(){n.resolve()}),n.promise):(setTimeout(function(){n.reject()},10),n.promise)},r.exports.resetSerialPort=function(e){var r=o.defer(),n=new i(e,{baudRate:1200});return n.on("open",function(){n.set({rts:!0,dtr:!1}),setTimeout(function(){n.close(function(){r.resolve()})},650)}).on("error",function(e){t.error(e),n.close(function(){r.reject(e)})}),r.promise}},{"electron-log":void 0,path:void 0,q:void 0,serialport:void 0}],6:[function(e,r,n){function t(){return i.join(s.getAppDataPath(),"token")}var o,i=e("path"),a=e("crypto"),u=e("q"),c=e("fs-extra"),s=e("./util"),f=e("electron-log");r.exports.get=function(){return o},r.exports.set=function(e){o=e},r.exports.remove=function(){o=null,s.removeFile(t(),!0)},r.exports.save=function(e){var r=u.defer(),n=a.randomBytes(128);return s.writeFile(t(),s.encrypt(JSON.stringify(e),n)).then(function(){r.resolve(n.toString("hex"))},function(e){e&&f.error(e),r.reject(e)}),r.promise},r.exports.load=function(e){var r=u.defer(),n=t();return c.existsSync(n)?(s.readFile(n,"utf8").then(function(n){try{var t=s.decrypt(n,Buffer.from(e,"hex"));r.resolve(JSON.parse(t))}catch(e){r.reject()}},function(e){e&&f.error(e),r.reject(e)}),r.promise):(setTimeout(function(){r.reject()},10),r.promise)}},{"./util":7,crypto:void 0,"electron-log":void 0,"fs-extra":void 0,path:void 0,q:void 0}],7:[function(e,r,n){function t(){return g.windows()?"win":g.macOS()?"mac":c.arch().indexOf("arm")>=0?"arm":"linux"}function o(){return g.dev()?A.version:d.getVersion()}function i(){return parseInt((new Date).getTime()/1e3)}function a(e,r,n){var t=j.defer();return r=r||{},n=n||!1,h.debug("execCommand:"+e+", options: "+JSON.stringify(r)+", useSudo: "+n),n?x.exec(e,{name:"kenrobot"},function(e,r,n){if(r=g.windows()?w.decode(r||"","gbk"):r,n=g.windows()?w.decode(n||"","gbk"):n,e)return h.error(e),r&&h.error(r),n&&h.error(n),void t.reject(n||r||e);g.dev()&&h.debug(r),t.resolve(r)}):s.exec(e,r,function(e,r,n){if(r=g.windows()?w.decode(r||"","gbk"):r,n=g.windows()?w.decode(n||"","gbk"):n,e)return h.error(e),r&&h.error(r),n&&h.error(n),void t.reject(n||r||e);g.dev()&&h.debug(r),t.resolve(r)}),t.promise}function u(e,r,n){var t=j.defer(),o=s.spawn(e,r,n),i="",a="";return o.stdout.on("data",function(e){var r=g.windows()?w.decode(e,"gbk"):e.toString();g.dev()&&h.debug(r),i+=r,t.notify({type:"stdout",data:r})}),o.stderr.on("data",function(e){var r=g.windows()?w.decode(e,"gbk"):e.toString();g.dev()&&h.debug(r),a+=r,t.notify({type:"stderr",data:r})}),o.on("close",function(e){0==e?t.resolve(i):t.reject(a)}),t.promise}var c=e("os"),s=e("child_process"),f=e("path"),p=e("crypto"),l=e("electron"),d=l.app,v=l.dialog,m=l.BrowserWindow,h=e("electron-log"),g=e("electron-is"),j=e("q"),b=e("fs-extra"),y=e("glob"),x=e("sudo-prompt"),w=e("iconv-lite"),P=e("7zip-bin").path7za.replace("app.asar","app.asar.unpacked"),S=e("node-fetch"),A=e("../package"),D="-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC7Jat1/19NDxOObrFpW8USTia6\nuHt34Sac1Arm6F2QUzsdUEUmvGyLIOIGcdb+F6pTdx4ftY+wZi7Aomp4k3vNqXmX\nT0mE0vpQlCmsPUcMHXuUi93XTGPxLXIv9NXxCJZXSYI0JeyuhT9/ithrYlbMlyNc\nwKB/BwSpp+Py2MTT2wIDAQAB\n-----END PUBLIC KEY-----\n";g.dev()&&d.setName(A.productName);var I={},_=0;r.exports.getPlatform=t,r.exports.getVersion=o,r.exports.getAppInfo=function(){var e={bit:"x64"===process.arch||process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432")?64:32,arch:process.arch,platform:t(),version:o(),name:d.getName(),buildNumber:A.buildNumber};return g.dev()?(e.ext=f.extname(d.getPath("exe")).replace(".",""),e.branch="beta",e.feature="",e.date=i(),e.appBit=e.bit):(e.ext=A.buildInfo.ext,e.branch=A.buildInfo.branch,e.feature=A.buildInfo.feature,e.date=A.buildInfo.date,e.appBit=A.buildInfo.appBit),e},r.exports.getAppDataPath=function(){return f.join(d.getPath("appData"),d.getName())},r.exports.getAppResourcePath=function(){return g.windows()||g.dev()?f.resolve("."):f.resolve(d.getAppPath(),"..","..")},r.exports.getAppDocumentPath=function(){return f.join(d.getPath("documents"),d.getName())},r.exports.getAppPath=function(e){return d.getPath(e)},r.exports.versionCompare=function(e,r){for(var n=/(\d+)\.(\d+)\.(\d+)/,t=n.exec(e),o=n.exec(r),i=[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])],a=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])],u=0;u<=2;u++)if(i[u]!=a[u])return i[u]>a[u]?1:-1;return 0},r.exports.postMessage=function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),t=1;t<r;t++)n[t-1]=arguments[t];h.debug("postMessage: "+e+", "+n.join(", "));var o=m.getAllWindows();o&&o.length&&o[0].webContents.send(e,n)},r.exports.getDefer=function(){var e=j.defer(),r=_++;return I[r]=e,{deferId:r,promise:e.promise}},r.exports.callDefer=function(e,r){var n=I[e];if(n){var t;"notify"==r?t=n.notify:(delete I[e],t=r?n.resolve:n.reject);for(var o=arguments.length,i=Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];t.apply(this,i)}},r.exports.handleQuotes=function(e){return g.windows()?e:e.replace(/"/g,"")},r.exports.uuid=function(e,r){var n,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(r=r||t.length,e)for(n=0;n<e;n++)o[n]=t[0|Math.random()*r];else{var i;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;n<36;n++)o[n]||(i=0|16*Math.random(),o[n]=t[19==n?3&i|8:i])}return o.join("")},r.exports.stamp=i,r.exports.throttle=function(e,r){var n;return function(){n&&clearTimeout(n),n=setTimeout(function(){e(),clearTimeout(n),n=null},r)}},r.exports.encrypt=function(e,r,n){n=n||"aes-128-cbc";var t=p.createCipher(n,r),o=t.update(e,"utf8","binary");return o+=t.final("binary"),o=new Buffer(o,"binary").toString("base64")},r.exports.decrypt=function(e,r,n){n=n||"aes-128-cbc",e=new Buffer(e,"base64").toString("binary");var t=p.createDecipher(n,r),o=t.update(e,"binary","utf8");return o+=t.final("utf8")},r.exports.rsa_encrypt=function(e,r){r=r||D;var n=new Buffer(e);return p.publicEncrypt({key:r,padding:p.constants.RSA_PKCS1_PADDING},n).toString("base64")},r.exports.rsa_decrypt=function(e,r){var n=new Buffer(e,"base64");return p.privateDecrypt({key:r,padding:p.constants.RSA_PKCS1_PADDING},n).toString("utf8")},r.exports.resolvePromise=function(e,r){return r=r||j.defer(),setTimeout(function(){r.resolve(e)},10),r.promise},r.exports.rejectPromise=function(e,r){return r=r||j.defer(),setTimeout(function(){r.reject(e)},10),r.promise},r.exports.execFile=function(e){var r=j.defer();h.debug("execFile: "+e);var n;return n=g.windows()?"start /WAIT "+e:""+e,a(n,null,!0).fin(function(){r.resolve()}),r.promise},r.exports.execCommand=a,r.exports.spawnCommand=u,r.exports.readFile=function(e,r,n){if(n)return b.readFileSync(e,r);var t=j.defer();return r=r||"utf8",b.readFile(e,r,function(e,r){if(e)return h.error(e),void t.reject(e);t.resolve(r)}),t.promise},r.exports.writeFile=function(e,r,n,t){if(!t){var o=j.defer();return b.outputFile(e,r,n,function(e){if(e)return h.error(e),void o.reject(e);o.resolve()}),o.promise}b.outputFileSync(e,r,n)},r.exports.moveFile=function(e,r,n){var t=j.defer();return n=n||{overwrite:!0},b.move(e,r,n,function(e){if(e)return h.error(e),void t.reject(e);t.resolve()}),t.promise},r.exports.removeFile=function(e,r){if(!r){var n=j.defer();return b.remove(e,function(e){if(e)return h.error(e),void n.reject(e);n.resolve()}),n.promise}b.removeSync(e)},r.exports.readJson=function(e,r){var n=j.defer();return r=r||{},b.readJson(e,r,function(e,r){if(e)return h.error(e),void n.reject(e);n.resolve(r)}),n.promise},r.exports.writeJson=function(e,r,n,t){if(!t){var o=j.defer();return n=n||{},b.outputJson(e,r,n,function(e){if(e)return h.error(e),void o.reject(e);o.resolve()}),o.promise}b.outputJsonSync(e,r,n)},r.exports.searchFiles=function(e){var r=j.defer();return h.debug("searchFiles: "+e),y(e,{},function(e,n){return e?(h.error(e),void r.reject(e)):r.resolve(n)}),r.promise},r.exports.unzip=function(e,r,n){var t=j.defer(),o=/([\d]+)% \d+ - .*\r?/g;return h.debug("unzip: "+e+" => "+r),n?u('"'+P+'"',["x",'"'+e+'"',"-bsp1","-y",'-o"'+r+'"'],{shell:!0}).then(function(e){t.resolve(e)},function(e){e&&h.error(e),t.reject(e)},function(e){if(o.lastIndex=0,o.test(e.data)){var r,n=o.exec(e.data);do{r=n,n=o.exec(e.data)}while(n);t.notify(parseInt(r[1]))}}):a('"'+P+'" x "'+e+'" -y -o"'+r+'"').then(function(){t.resolve()},function(e){e&&h.error(e),t.reject(e)}),t.promise},r.exports.zip=function(e,r,n,t){var o=j.defer();return r=r instanceof Array?r:[r],t=t||"7z",a('cd "'+e+'" && "'+P+'" a -t'+t+" -r "+n+" "+r.join(" ")).then(function(){o.resolve()},function(e){e&&h.error(e),o.reject(e)}),o.promise},r.exports.showOpenDialog=function(e,r){var n=j.defer();return e=e||{},e.title="打开",e.defaultPath=e.defaultPath||d.getPath("documents"),e.buttonLabel="打开",r=r||m.getAllWindows()[0],v.showOpenDialog(r,e,function(e){e?n.resolve(e[0]):n.reject()}),n.promise},r.exports.showSaveDialog=function(e,r){var n=j.defer();return e=e||{},e.title="保存",e.defaultPath=e.defaultPath||f.join(d.getPath("documents"),"untitled"),e.buttonLabel="保存",r=r||m.getAllWindows()[0],v.showSaveDialog(r,e,function(e){e?n.resolve(e):n.reject()}),n.promise},r.exports.request=function(e,r,n){var t=j.defer();if(r=r||{},n=!1!==n,r.method=r.method||"GET",n&&r.data){r.body=JSON.stringify(r.data);var o=r.headers||(r.headers={});o["Content-Type"]="application/json",o.Accept="application/json",delete r.data}return S(e,r).then(function(e){if(e.ok)return n?e.json():e;var r=new Error(e.statusText);throw r.status=e.status,r}).then(function(e){t.resolve(e)}).catch(function(e){e&&h.error(e),t.reject(e)}),t.promise}},{"../package":void 0,"7zip-bin":void 0,child_process:void 0,crypto:void 0,electron:void 0,"electron-is":void 0,"electron-log":void 0,"fs-extra":void 0,glob:void 0,"iconv-lite":void 0,"node-fetch":void 0,os:void 0,path:void 0,q:void 0,"sudo-prompt":void 0}]},{},[2]);