"use strict";var _slicedToArray=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")};!function i(a,u,c){function s(t,e){if(!u[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(f)return f(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=u[t]={exports:{}};a[t][0].call(o.exports,function(e){var n=a[t][1][e];return s(n||e)},o,o.exports,i,a,u,c)}return u[t].exports}for(var f="function"==typeof require&&require,e=0;e<c.length;e++)s(c[e]);return s}({1:[function(e,n,t){n.exports={default:{build:{fqbn:"arduino:avr:uno:cpu=atmega328p",prefs:{"runtime.tools.avr-gcc.path":'"ARDUINO_PATH/hardware/tools/avr"',"runtime.tools.avrdude.path":'"ARDUINO_PATH/hardware/tools/avr"',"build.warn_data_percentage":"75"},target_type:"hex",command:'"ARDUINO_PATH/arduino-builder" -compile -logger=machine -hardware="ARDUINO_PATH/hardware" -hardware="ARDUINO_PATH/packages" -tools="ARDUINO_PATH/tools-builder" -tools="ARDUINO_PATH/hardware/tools/avr" -tools="ARDUINO_PATH/packages" -built-in-libraries="ARDUINO_PATH/libraries" -ide-version=10612 -warnings=none BUILD_SPECS -build-path="PROJECT_BUILD_PATH" "PROJECT_ARDUINO_FILE"'},upload:{target_type:"hex",mcu:"atmega328p",baudrate:"115200",programer:"arduino",command:'"ARDUINO_PATH/hardware/tools/avr/bin/avrdude" -C "ARDUINO_PATH/hardware/tools/avr/etc/avrdude.conf" -v -p ARDUINO_MCU -c ARDUINO_PROGRAMMER -b ARDUINO_BURNRATE -P ARDUINO_COMPORT -D -U "flash:w:TARGET_PATH:i"'}},librariesPath:[]}},{}],2:[function(e,n,t){n.exports={Arduino:-999,Boxz:10,Intel:20,Kenblock:30,UperEnergy:40,standardPackage:"Arduino"}},{}],3:[function(e,n,t){n.exports={SUCCESS:0,INVALID_PARAM:1,SYSTEM_ERROR:100,LOGIN_REQUIRED:200,PERMISSION_DENIED:201,INVALID_USER_TOKEN_SIGN:202,USER_TOKEN_EXPIRED:203,USER_NOT_EXITS:204,API_ERROR:300,INVALID_SSO_TICKET:301,INVALID_SSO_SESSION:302,INVALID_SSO_BROKER:303,INVLAID_SSO_SIGN:304}},{}],4:[function(e,n,t){n.exports={CHECK_UPDATE:"http://www.kenrobot.com/downloads/checkupdate",REPORT:"http://server.kenrobot.com/statistics/report",REGISTER:"http://server.kenrobot.com/register",FIND_PASSWORD:"http://server.kenrobot.com/password/email",LOGIN:"http://server.kenrobot.com/api/auth/login",LOGOUT:"http://server.kenrobot.com/api/auth/logout",WEIXIN_QRCODE:"http://server.kenrobot.com/api/auth/weixin/token",WEIXIN_LOGIN:"http://server.kenrobot.com/api/auth/weixin/login",VERIFY:"http://server.kenrobot.com/api/auth/verify",PACKAGE:"http://www.kenrobot.com/packages/packages.json",PROJECT_SYNC_LIST:"http://server.kenrobot.com/api/project/sync/list",PROJECT_SYNC_CREATE:"http://server.kenrobot.com/api/project/sync/create",PROJECT_SYNC_DELETE:"http://server.kenrobot.com/api/project/sync/delete",PROJECT_SYNC_UPLOAD:"http://server.kenrobot.com/api/project/sync/upload",PROJECT_SYNC_DOWNLOAD:"http://server.kenrobot.com/api/project/sync/download",PROJECT_SYNC_ITEM:"http://server.kenrobot.com/api/project/sync/item"}},{}],5:[function(e,n,t){var r,f,u,o,i,a,c,s=e("electron"),l=s.app,p=s.BrowserWindow,d=(s.dialog,s.ipcMain,s.shell),m=s.clipboard,v=e("path"),h=e("querystring"),g=e("electron-is"),j=e("electron-debug"),b=e("electron-log"),P=e("q"),x=e("fs-extra"),y=e("command-line-args"),w=e("hasha"),A=e("lodash"),I=e("terminate"),S=e("./util/util"),_=e("./model/serialPort"),O=e("./config/arduinoOptions"),E=e("./config/url"),D=(e("./model/token"),e("./model/project")),R=e("./model/user"),T=e("./model/package"),k=e("./util/cache"),N="config",C=S.listenMessage,U=[{name:"debug-brk",type:Number,defaultValue:!1},{name:"dev",alias:"d",type:Boolean,defaultValue:!1},{name:"devTool",alias:"t",type:Boolean,defaultValue:!1},{name:"fullscreen",alias:"f",type:Boolean,defaultValue:!1},{name:"maximize",alias:"m",type:Boolean,defaultValue:!1},{name:"project",alias:"p",type:D.check,defaultOption:!0}],F=y(U,{argv:process.argv.slice(1),partial:!0}),q=g.dev()&&F.dev,L=g.dev(),B={};function M(){b.debug("app ready"),q&&j({enabled:!0,showDevTools:!0}),F.project&&(i=F.project),J(),ee(),function(){if(L||f.version==S.getVersion())return;f.version=S.getVersion(),f.reportInstall=!1,o=!0,r.setItem(N,f)}(),function(){L||f.reportInstall||K(null,"installations").then(function(){f.reportInstall=!0,r.setItem(N,f)});K(null,"open")}()}function J(){u=new p({width:1200,height:720,minWidth:1200,minHeight:720,frame:!1,show:!1,webPreferences:{webSecurity:!1}}),F.fullscreen?u.setFullScreen(!0):F.maximize&&u.maximize(),u.on("closed",function(){return u=null}).once("ready-to-show",function(){return u.show()}).on("enter-full-screen",function(){return S.postMessage("app:onFullscreenChange",!0)}).on("leave-full-screen",function(){return S.postMessage("app:onFullscreenChange",!1)}),u.webContents.on("will-navigate",function(e){return e.preventDefault()}).on("devtools-reload-page",function(){return _.closeAllSerialPort()}),u.webContents.session.on("will-download",W),u.loadURL("file://"+__dirname+"/../renderer/index.html"),u.focus()}function z(e,n){e.preventDefault(),i=D.check(n),a&&ne().then(function(e){S.postMessage("app:onLoadProject",e)},function(e){e&&b.info(e)})}function G(e){c||(e.preventDefault(),S.postMessage("app:onBeforeQuit"))}function H(e){return _.closeAllSerialPort(),S.removeFile(v.join(S.getAppPath("appData"),"temp"),!0),!0}function K(n,t){var r=P.defer(),e=S.getAppInfo(),o={version:e.version,platform:e.platform,bit:e.appBit,ext:e.ext,branch:e.branch,feature:e.feature};return n=A.merge({},n,o),t=t||"log",S.request(E.REPORT,{method:"post",data:{data:JSON.stringify(n),type:t}}).then(function(){r.resolve()},function(e){b.info("report error: type: "+t+", "+JSON.stringify(n)),e&&b.info(e),r.reject(e)}),r.promise}function V(e){var n=P.defer();return e=0!=e,T.loadAll(e).then(function(e){e.forEach(function(e){var n=v.join(e.path,e.libraries||"src");x.existsSync(n)&&!O.librariesPath.includes(n)&&O.librariesPath.push(n)}),n.resolve(e)},function(e){e&&b.info(e),n.reject(e)}),n.promise}function W(e,t,n){var r=S.uuid(6),o=(B[r]=t).getURL(),i=o.lastIndexOf("#"),a=h.parse(o.substring(i+1));o=o.substring(0,i);var u=a.deferId,c=v.join(S.getAppPath("appData"),"download",t.getFilename());if(a.checksum&&x.existsSync(c)){i=a.checksum.indexOf(":");var s=a.checksum.substring(0,i).replace("-","").toLowerCase();if(a.checksum.substring(i+1)==w.fromFileSync(c,{algorithm:s}))return t.cancel(),b.debug("download cancel, "+o+" has cache"),void S.callDefer(u,!0,{path:c})}t.setSavePath(c);var f=t.getTotalBytes();t.on("updated",function(e,n){"interrupted"==n?(B[r]&&delete B[r],b.debug("download interrupted: "+o),S.callDefer(u,!1,{path:c})):"progressing"===n&&(t.isPaused()?(B[r]&&delete B[r],b.debug("download paused: "+o),S.callDefer(u,!1,{path:c})):S.callDefer(u,"notify",{taskId:r,path:c,totalSize:f,size:t.getReceivedBytes()}))}),t.once("done",function(e,n){B[r]&&delete B[r],"completed"==n?(b.debug("download success: "+o+", at "+c),S.callDefer(u,!0,{path:c})):(b.debug("download fail: "+o),S.callDefer(u,!1,{path:c}))})}function Y(e,n){S.postMessage("app:onSerialPortError",e,n)}function Q(e,n){S.postMessage("app:onSerialPortData",e,n)}function X(e){S.postMessage("app:onSerialPortClose",e)}function $(){var i=P.defer();return _.listSerialPort().then(function(e){var n,t,r,o=(n=/(COM\d+)|(usb-serial)|(arduino)|(\/dev\/cu\.usbmodem)|(\/dev\/tty\.)|(\/dev\/(ttyUSB|ttyACM|ttyAMA))/,e.filter(function(e){return n.test(e.comName)}));0!=o.length?(t=o,r=P.defer(),b.debug("matchBoardNames"),ee().then(function(e){t.forEach(function(e){if(e.productId&&e.vendorId){var n=f.boardNames[e.productId+"_"+e.vendorId];n&&(e.boardName=n.name)}}),r.resolve(t)},function(e){e&&b.info(e),r.reject(e)}),r.promise).then(function(){b.debug(o.map(function(e){return e.comName+", pid: "+e.productId+", vid: "+e.vendorId+", boardName: "+(e.boardName||"")}).join("\n")),i.resolve(o)},function(e){e&&b.info(e),i.reject(e)}):i.reject({status:"NO_ARDUINO_PORT",ports:e})},function(e){e&&b.info(e),i.reject(e)}),i.promise}function Z(t,e,r){var o=P.defer();return function(e,n,t){var r=P.defer();b.debug("pre upload firmware");var o=A.merge({},O.default.upload,n.upload),i=S.getAppPath("command","upload"),a=S.handleQuotes(o.command);return a=a.replace(/ARDUINO_PATH/g,S.getAppPath("arduino")).replace("ARDUINO_MCU",o.mcu).replace("ARDUINO_BURNRATE",o.baudrate).replace("ARDUINO_PROGRAMMER",o.programer).replace("ARDUINO_COMPORT",t).replace("TARGET_PATH",e),S.writeFile(i,a).then(function(){_.resetSerialPort(t).then(function(){r.resolve(i)},function(e){e&&b.info(e),r.reject(e)})},function(e){e&&b.info(e),r.reject(e)}),r.promise}(t,e,r).then(function(e){b.debug("upload firmware: "+t+", "+r+", command path: "+e);var n=S.getAppPath("script","call");S.spawnCommand('"'+n+'"',['"'+e+'"'],{shell:!0}).then(function(){o.resolve()},function(e){e&&b.info(e),o.reject(e)},function(e){o.notify(e)})},function(e){e&&b.info(e),o.reject(e)}),o.promise}function ee(e){var n=P.defer();if(f.boardNames&&!e)return b.debug("skip loadBoards"),setTimeout(function(){n.resolve(f.boardNames)},10),n.promise;b.debug("loadBoards");var a={},u=/\n(([^\.\n]+)\.pid(\.\d)?)=([^\r\n]+)/g,c=/\n(([^\.\n]+)\.vid(\.\d)?)=([^\r\n]+)/g,s=/\n([^\.\n]+)\.name=([^\r\n]+)/g,t="arduino-"+S.getPlatform();return S.searchFiles(t+"/**/boards.txt").then(function(e){P.all(e.map(function(e){var n=P.defer();return S.readFile(e).then(function(e){var n=e.match(u),t=e.match(c),r=e.match(s),o=[];r.forEach(function(e){var n=e.substring(0,e.indexOf(".name")).trim(),t=e.substring(e.indexOf("=")+1).trim();o[n]=t});var i=n.map(function(e){return e.substring(0,e.indexOf(".pid")).trim()});n=n.map(function(e){return e.substring(e.indexOf("=")+3)}),t=t.map(function(e){return e.substring(e.indexOf("=")+3)}),n.forEach(function(e,n){a[e+"_"+t[n]]={pid:e,vid:t[n],type:i[n],name:o[i[n]]}})}).fin(function(){n.resolve()}),n.promise})).then(function(){f.boardNames=a,r.setItem(N,f),n.resolve(f.boardNames)})},function(e){e&&b.info(e),n.reject(e)}),n.promise}function ne(){if(a=!0,i){b.debug("loadOpenProject: "+i);var e=i;return i=null,D.read(e)}return S.rejectPromise()}!function(){process.on("uncaughtException",function(e){var n=e.stack||e.name+": "+e.message;b.info(n),l.quit()}),q?(b.transports.console.level="debug",b.transports.file.level="debug"):(b.transports.console=!1,b.transports.file.format="[{y}-{m}-{d} {h}:{i}:{s}] [{level}] {text}",b.transports.file.level="info"),r=new k(N),f=r.getItem(N,{}),S.removeFile(v.join(S.getAppPath("appData"),"config.json"),!0),l.makeSingleInstance(function(e,n){if(u){u.isMinimized()&&u.restore(),u.focus();var t=y(U,{argv:e.slice(1),partial:!0});t.project&&(i=t.project),b.debug("app second run"),ne().then(function(e){S.postMessage("app:onLoadProject",e)},function(e){e&&b.info(e)})}})&&l.quit();l.on("ready",M).on("window-all-closed",function(){return"darwin"!==process.platform&&l.quit()}).on("activate",function(){return null===u&&J()}).on("before-quit",G).on("will-quit",H).on("quit",function(){return b.debug("app quit")}),g.macOS()&&l.on("open-file",z),function(){C("getAppInfo",function(){return S.resolvePromise(S.getAppInfo())}),C("execFile",function(e){return S.execFile(e)}),C("execCommand",function(e,n){return S.execCommand(e,n)}),C("spawnCommand",function(e,n,t){return S.spawnCommand(e,n,t)}),C("readFile",function(e,n){return S.readFile(e,n)}),C("writeFile",function(e,n){return S.writeFile(e,n)}),C("saveFile",function(e,n,t){return S.saveFile(e,n,t)}),C("moveFile",function(e,n,t){return S.moveFile(e,n,t)}),C("removeFile",function(e){return S.removeFile(e)}),C("searchFiles",function(e){return S.searchFiles(e)}),C("readJson",function(e,n){return S.readJson(e,n)}),C("writeJson",function(e,n,t,r){return S.writeJson(e,n,t,r)}),C("showOpenDialog",function(e){return S.showOpenDialog(e)}),C("showSaveDialog",function(e){return S.showSaveDialog(e)}),C("request",function(e,n,t){return S.request(e,n,t)}),C("showItemInFolder",function(e){return S.resolvePromise(d.showItemInFolder(v.normalize(e)))}),C("openUrl",function(e){return S.resolvePromise(e&&d.openExternal(e))}),C("listSerialPort",function(){return $()}),C("openSerialPort",function(e,n){return t=e,r=n,_.openSerialPort(t,r,{onError:Y,onData:Q,onClose:X});var t,r}),C("writeSerialPort",function(e,n){return _.writeSerialPort(e,n)}),C("closeSerialPort",function(e){return _.closeSerialPort(e)}),C("updateSerialPort",function(e,n){return _.updateSerialPort(e,n)}),C("flushSerialPort",function(e){return _.flushSerialPort(e)}),C("buildProject",function(e,n){return t=e,r=n,o=P.defer(),function(e,c){var s=P.defer();b.debug("pre-build");var t=v.join(e,"cache"),f=v.join(t,"build");return x.ensureDirSync(f),S.removeFile(v.join(f,"sketch","build"),!0),S.removeFile(v.join(e,"build"),!0),D.read(e).then(function(e){var n=e.data,u=v.join(t,n.project_name+".ino");S.writeFile(u,n.project_data.code).then(function(){var t=[],r=A.merge({},O.default.build,c.build),e=S.getAppPath("packages");x.existsSync(e)&&t.push("-hardware="+e),t.push("-fqbn="+r.fqbn);var o=S.getAppPath("arduino");Object.keys(r.prefs).forEach(function(e){var n=S.handleQuotes(r.prefs[e]);n=n.replace(/ARDUINO_PATH/g,o),t.push("-prefs="+e+"="+n)});var n=S.getAppPath("libraries");x.existsSync(n)&&t.push('-libraries="'+n+'"'),O.librariesPath.forEach(function(e){t.push('-libraries="'+e+'"')});var i=S.getAppPath("command","build"),a=S.handleQuotes(r.command);a=a.replace(/ARDUINO_PATH/g,S.getAppPath("arduino")).replace("BUILD_SPECS",t.join(" ")).replace("PROJECT_BUILD_PATH",f).replace("PROJECT_ARDUINO_FILE",u),S.writeFile(i,a).then(function(){var e=v.join(f,"build.options.json");if(!x.existsSync(e))return setTimeout(function(){return s.resolve(i)},10),s.promise;S.readJson(e).then(function(e){r.fqbn!=e.fqbn?S.removeFile(f).fin(function(){x.ensureDirSync(f),s.resolve(i)}):s.resolve(i)},function(e){e&&b.info(e),s.resolve(i)})},function(e){e&&b.info(e),s.reject()})},function(e){e&&b.info(e),s.reject()})},function(e){e&&b.info(e),s.reject()}),s.promise}(t,r).then(function(e){b.debug("buildProject: "+t+", command path: "+e);var n=S.getAppPath("script","call");S.spawnCommand('"'+n+'"',['"'+e+'"'],{shell:!0}).then(function(){var e=A.merge({},O.default,r),n=v.join(t,"cache","build",v.basename(t)+".ino."+e.upload.target_type);o.resolve(n)},function(e){e&&b.info(e),o.reject(e)},function(e){o.notify(e)})},function(e){e&&b.info(e),o.reject(e)}),o.promise;var t,r,o}),C("uploadFirmware",function(e,n,t){return function(n,t,e){if(!e){var r=P.defer();return $().then(function(e){1==e.length?Z(n,t,e[0].comName).then(function(){r.resolve()},function(e){r.reject(e)},function(e){r.notify(e)}):r.reject({status:"SELECT_PORT",ports:e})},function(e){e&&"NO_ARDUINO_PORT"===e.status?r.reject(e):r.reject({status:"PORT_NOT_FOUND"})}),r.promise}return Z(n,t,e)}(e,n,t)}),C("download",function(e,n){return function(e,n){var t=P.defer(),r=S.getDefer(),o=r.deferId,i=r.promise;n.deferId=o;var a=h.stringify(n);return b.debug("download "+e+", options: "+a),i.then(function(e){t.resolve(e)},function(e){e&&b.info(e),t.reject(e)},function(e){t.notify(e)}),u.webContents.downloadURL(e+"#"+a),t.promise}(e,n)}),C("cancelDownload",function(e){var n;(n=B[e])&&n.cancel()}),C("loadExamples",function(){return T.loadExamples()}),C("openExample",function(e){return n=e,t=P.defer(),b.debug("openExample: "+n),D.read(n).then(function(e){e.path=null,t.resolve(e)},function(e){e&&b.info(e),t.reject(e)}),t.promise;var n,t}),C("installDriver",function(){return function(){var n=P.defer();if(!g.windows())return S.rejectPromise(null,n);var e=64===S.getAppInfo().bit?"x64":"x86";b.debug("install driver: "+e);var t=v.join(S.getAppPath("driver"),e,"setup.exe");return S.execCommand('"'+t+'" /sw /c',{},!L).then(function(){n.resolve()},function(e){!e||void 0===e.code||e.code%256!=0&&1!==e.code?n.reject(e&&e.message?e.message:e):n.resolve()}),n.promise}()}),C("repairDriver",function(){return function(){var e=P.defer();if(!g.windows())return S.rejectPromise(null,e);b.debug("repair driver");var n=v.join(S.getAppPath("driver"),"repair","repair.bat");return S.execCommand('"'+n+'"',{},!L).then(function(){e.resolve()},function(){e.reject()}),e.promise}()}),C("unzipPackage",function(e,n,t){return T.unzip(e,n,t)}),C("deletePackage",function(e){return T.remove(e)}),C("unzipPackages",function(e){return n=e,t=P.defer(),n=!1===n&&L,T.unzipAll(f.packages,n,o).then(function(e){L||(f.packages=e,r.setItem(N,f)),t.resolve()},function(e){e&&b.info(e),t.reject(e)},function(e){return t.notify(e)}),t.promise;var n,t}),C("loadPackages",function(e){return V(e)}),C("loadRemotePackages",function(){return T.loadRemote()}),C("getInstalledLibraries",function(){return n=P.defer(),o=/^([^=]+)=(.*)$/gm,S.searchFiles(S.getAppPath("libraries")+"/**/library.properties").then(function(e){var r=[];P.all(e.map(function(e){var n=P.defer();return S.readFile(e).then(function(e){var n=e.match(o);if(!(n.length<0)){var t={};n.map(function(e){return e.split("=")}).forEach(function(e){t[e[0]]=e[1]}),t.name&&t.version&&r.push(t)}}).fin(function(){n.resolve()}),n.promise})).then(function(){n.resolve(r)})},function(e){e&&b.info(e),n.reject(e)}),n.promise;var n,o}),C("loadLibraries",function(){return n=P.defer(),S.readJson(v.join(S.getAppPath("appResource"),"libraries","libraries.json")).then(function(e){n.resolve(e.libraries)},function(e){e&&b.info(e),n.reject(e)}),n.promise;var n}),C("unzipLibrary",function(e,n){return t=e,r=n,o=P.defer(),i=S.getAppPath("libraries"),a=v.basename(r,v.extname(r)),S.uncompress(r,i,!0).then(function(){S.moveFile(v.join(i,a),v.join(i,t)).then(function(){o.resolve()},function(e){e&&b.info(e),o.reject(e)})},function(e){e&&b.info(e),o.reject(e)},function(e){o.notify(e)}),o.promise;var t,r,o,i,a}),C("deleteLibrary",function(e){return n=e,t=P.defer(),b.debug("deleteLibrary: "+n),S.removeFile(v.join(S.getAppPath("libraries"),n)).then(function(){t.resolve()},function(e){e&&b.info(e),t.reject(e)}),t.promise;var n,t}),C("checkUpdate",function(){return n=P.defer(),e=S.getAppInfo(),t=e.feature?e.feature+","+e.arch:e.arch,r=E.CHECK_UPDATE+"?appname="+e.name+"&release_version="+e.branch+"&version="+e.version+"&platform="+e.platform+"&ext="+e.ext+"&features="+t,b.debug("checkUpdate: "+r),S.request(r).then(function(e){n.resolve(e)},function(e){e&&b.info(e),n.reject(e)}),n.promise;var n,e,t,r}),C("checkPackageLibraryUpdate",function(){return i=P.defer(),P.all([V(!1),T.loadRemote()]).then(function(e){var n=e[0],t=e[1],r=[];n.forEach(function(n){var e=t.find(function(e){return e.name==n.name&&0<S.versionCompare(e.version,n.version)});e&&r.push(e)});var o=0;0<r.length&&(o=1),i.resolve({status:o})},function(e){e&&b.info(e),i.reject(e)}),i.promise;var i}),C("removeOldVersions",function(e){return r=e,n=P.defer(),t=S.getAppInfo(),o=v.join(S.getAppPath("appData"),"download"),S.searchFiles(o+"/"+t.name+"-*."+t.ext).then(function(e){var t=/\d+\.\d+\.\d+/;e.map(function(e){return v.basename(e)}).filter(function(e){var n=e.match(t);return!!n&&S.versionCompare(n[0],r)<0}).forEach(function(e){S.removeFile(v.join(o,e),!0)}),n.resolve()},function(e){e&&b.info(e),n.reject(e)}),n.promise;var r,n,t,o}),C("reportToServer",function(e,n){return K(e,n)}),C("loadToken",function(){return R.loadToken()}),C("login",function(e,n){return R.login(e,n)}),C("logout",function(){return R.logout()}),C("weixinLogin",function(e){return R.weixinLogin(e)}),C("weixinQrcode",function(){return R.weixinQrcode()}),C("register",function(e){return R.register(e)}),C("resetPassword",function(e){return R.resetPassword(e)}),C("setCache",function(e,n){return e!==N?r.setItem(e,n):S.rejectPromise()}),C("getCache",function(e,n){return e!==N?S.resolvePromise(r.getItem(e,n)):S.rejectPromise()}),C("loadOpenOrRecentProject",function(){return n=P.defer(),ne().then(function(e){n.resolve(e)},function(){var e=r.getItem("recentProject");e?D.read(e).then(function(e){n.resolve(e)},function(e){n.reject(e)}):S.rejectPromise(null,n)}),n.promise;var n}),C("projectRead",function(e){return D.read(e)}),C("projectOpen",function(e){return D.open(e)}),C("projectSave",function(e,n,t){return D.save(e,n,t)}),C("projectSaveAs",function(e,n,t){return D.saveAs(e,n,t)}),C("projectSync",function(){return D.sync()}),C("projectList",function(){return D.list()}),L&&(C("projectCreate",function(e){return D.create(e)}),C("projectUpload",function(e,n){return D.upload(e,n)}),C("projectDelete",function(e,n){return D.remove(e,n)}),C("projectDownload",function(e,n){return D.download(e,n)}));C("log",function(e,n){return(b[n]||b.debug).bind(b).call(e)}),C("copy",function(e,n){return m.writeText(e,n)}),C("quit",function(){return l.quit()}),C("exit",function(){return(c=!0)&&H()&&I(process.pid)}),C("reload",function(){return u.reload()}),C("relaunch",function(){return l.relaunch({args:process.argv.slice(1).concat(["--relaunch"])}),void l.exit(0)}),C("fullscreen",function(){return u.setFullScreen(!u.isFullScreen())}),C("min",function(){return u.minimize()}),C("max",function(){u.isFullScreen()?u.setFullScreen(!1):u.isMaximized()?u.unmaximize():u.maximize()}),C("errorReport",function(e,n){return t=e,r=n,void b.info(r+": "+t);var t,r})}(),b.debug("app "+l.getName()+" start, version "+S.getVersion())}()},{"./config/arduinoOptions":1,"./config/url":4,"./model/package":6,"./model/project":7,"./model/serialPort":8,"./model/token":9,"./model/user":10,"./util/cache":11,"./util/util":12,"command-line-args":void 0,electron:void 0,"electron-debug":void 0,"electron-is":void 0,"electron-log":void 0,"fs-extra":void 0,hasha:void 0,lodash:void 0,path:void 0,q:void 0,querystring:void 0,terminate:void 0}],6:[function(e,n,t){var c=e("path"),s=e("fs-extra"),f=e("q"),l=e("electron-log"),i=e("electron-is"),o=e("lodash"),p=e("../util/util"),a=e("../config/packageOrders"),u=e("../config/url");function d(e,t,n){var r=f.defer(),o=function(){p.uncompress(t,p.getAppPath("packages"),!0).then(function(){var e=c.basename(t);e=e.substring(0,e.indexOf("-"));var n=i.windows()?"bat":"sh";p.searchFiles(c.join(p.getAppPath("packages"),e)+"/**/post_install."+n).then(function(e){if(0!=e.length){var n=e[0];p.execCommand('"'+n+'"',{cwd:c.dirname(n)}).then(function(){r.resolve()},function(e){e&&l.info(e),r.reject(e)})}else r.resolve()},function(e){e&&l.info(e),r.reject(e)})},function(e){e&&l.info(e),r.reject(e)},function(e){r.notify(e)})};return(n=!1!==n)?m(e).then(function(){return o()},function(e){e&&l.info(e),r.reject(e)}):o(),r.promise}function m(e){var n=f.defer();return l.debug("deletePackage: "+e),p.removeFile(c.join(p.getAppPath("packages"),e)).then(function(){n.resolve()},function(e){e&&l.info(e),n.reject(e)}),n.promise}n.exports.unzip=d,n.exports.unzipAll=function(o,e,i){var a=f.defer();if(o=o||[],e)return l.debug("skip unzip packages"),setTimeout(function(){return a.resolve()},10),a.promise;l.debug("unzip packages");var u=c.join(p.getAppPath("appResource"),"packages");return p.readJson(c.join(u,"packages.json")).then(function(e){var t=e.filter(function(n){return!!i||!!o.find(function(e){return e.name==n.name&&e.checksum!=n.checksum})||!s.existsSync(c.join(p.getAppPath("packages"),n.name,"package.json"))}),r=t.length;!function e(){if(0!=t.length){var n=t.pop();d(n.name,c.join(u,n.archiveName)).then(function(){var e=o.findIndex(function(e){return e.name==n.name});0<=e?o.splice(e,1,n):o.push(n)},function(e){},function(e){a.notify({progress:e,name:n.name,version:n.version,count:r-t.length,total:r})}).fin(function(){return e()})}else a.resolve(o)}()},function(e){e&&l.info(e),a.resolve()}),a.promise},n.exports.loadAll=function(t){var n=f.defer();t=!1!==t;var r=[],e=[p.getAppPath("appResource")+"/packages/*/package.json",p.getAppPath("packages")+"/*/package.json"];return l.debug("loadPackages: "+e.join(",")),p.searchFiles(e,{absolute:!0}).then(function(e){f.all(e.map(function(n){var e=f.defer();return t?p.readJson(n).then(function(t){a[t.name]&&(t.order=a[t.name]),t.name==a.standardPackage&&(t.builtIn=!0),t.path=c.dirname(n).replace(/\\/g,"/"),t.protocol=n.startsWith("/")?"file://":"file:///",t.boards&&t.boards.forEach(function(n){n.build&&n.build.prefs&&Object.keys(n.build.prefs).forEach(function(e){n.build.prefs[e]=n.build.prefs[e].replace("PACKAGE_PATH",t.path)}),n.upload&&n.upload.command&&(n.upload.command=n.upload.command.replace(/PACKAGE_PATH/g,t.path))}),r.push(t)}).fin(function(){e.resolve()}):p.readJson(n).then(function(e){e.path=c.dirname(n).replace(/\\/g,"/"),r.push(e)}).fin(function(){return e.resolve()}),e.promise})).then(function(){n.resolve(o.sortBy(r,["builtIn","order","name"],["asc","asc","asc"]))})},function(e){e&&l.info(e),n.reject(e)}),n.promise},n.exports.loadRemote=function(){var t=f.defer(),r=p.getAppInfo();return p.request(u.PACKAGE).then(function(e){var n=e.filter(function(e){return e.platform==r.platform});n.forEach(function(e){a[e.name]&&(e.order=a[e.name]),e.name==a.standardPackage&&(e.builtIn=!0)}),t.resolve(o.sortBy(n,["builtIn","order","name"],["asc","asc","asc"]))},function(e){e&&l.info(e),t.reject(e)}),t.promise},n.exports.remove=m,n.exports.loadExamples=function(){var n=f.defer(),t=[],e=[p.getAppPath("appResource")+"/packages/*/examples/examples.json",p.getAppPath("packages")+"/*/examples/examples.json"];return l.debug("loadExamples: "+e.join(",")),p.searchFiles(e,{absolute:!0}).then(function(e){f.all(e.map(function(n){var e=f.defer();return p.readJson(n).then(function(e){a[e.package]&&(e.order=a[e.package]),e.package==a.standardPackage&&(e.builtIn=!0),e.examples.forEach(function(e){e.path=c.join(c.dirname(n).replace(/\\/g,"/"),e.path||c.join(e.category,e.name))}),t.push(e)}).fin(function(){return e.resolve()}),e.promise})).then(function(){n.resolve(o.sortBy(t,["builtIn","order","name"],["asc","asc","asc"]))})},function(e){e&&l.info(e),n.reject(e)}),n.promise}},{"../config/packageOrders":2,"../config/url":4,"../util/util":12,"electron-is":void 0,"electron-log":void 0,"fs-extra":void 0,lodash:void 0,path:void 0,q:void 0}],7:[function(e,n,t){var v=e("path"),c=e("fs-extra"),h=e("q"),r=e("hasha"),g=e("electron-log"),j=e("../util/util"),s=e("./token"),f=e("../config/url"),b=".krb",a="krobot",l=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],p=96,i=j.throttle(d,2e3);function P(e){return e&&v.extname(e)==b&&c.existsSync(e)?e:null}function o(e){var n,t=h.defer();if(P(e))n=e;else{var r=v.basename(e);if(n=v.join(e,r+b),c.existsSync(n)||(n=v.join(e,"project.json")),!c.existsSync(n))return j.rejectPromise(null,t)}return j.readJson(n).then(function(e){t.resolve({path:v.dirname(n),project_type:e.project_type||"local",data:e})},function(e){e&&g.info(e),t.reject(e)}),t.promise}function u(e,t,n,r){var o,i,a,u,c=h.defer(),s=function(e,n){A(e,n,t,"local").then(function(e){c.resolve(e)},function(e){e&&g.info(e),c.reject(e)})};return n?(r=v.join(j.getAppPath("temp"),"build","sketch_"+j.stamp()),s(r,v.basename(r))):r?s(v.join(v.dirname(r),e),e):j.showSaveDialog({defaultPath:(o=new Date,i=l[o.getMonth()],a=(100+o.getDate()).toString().substring(1),p++,u=String.fromCharCode(p<=122?p:p=97),"sketch_"+i+a+u)}).then(function(e){s(e,v.basename(e))},function(e){e&&g.info(e),c.reject(e)}),c.promise}function d(){var t=h.defer();return g.debug("project sync"),h.all([m(),I()]).then(function(e){var n=_slicedToArray(e,2);(function(e,n){var a=h.defer(),t=function(e,n){var t={},r={};e.forEach(function(e){t[""+e.name]=e}),n.forEach(function(e){r[""+e.name]=e});var o=[],i=[],a=[];return e.forEach(function(e){var n=r[e.name];!n||!n.modify_time||n.modify_time<e.modify_time?o.push(e):P(v.join(E(),e.name,e.name+b))||o.push(e)}),n.forEach(function(e){var n=t[e.name];n?n.modify_time<e.modify_time&&i.push(e):(a.push(e),i.push(e))}),[a,o,i]}(e,n),r=_slicedToArray(t,3),u=r[0],o=r[1],c=r[2];g.debug("doSync: createList:"+u.length+", downloadList:"+o.length+", uploadList:"+c.length);var i=u.length+o.length+c.length,s=0,f=function(e,n){s++,a.notify({total:i,count:s,name:e,action:n})};return(l=o,p=f,m=h.defer(),(d=function(){if(0==l.length)return j.resolvePromise(!0,m);var e=l.shift();w(e.name,e.hash).then(function(){p(e.name,"download"),0==l.length?m.resolve():setTimeout(function(){return d()},100)},function(e){e&&g.info(e),m.reject(e)})})(),m.promise).then(function(){var t,r,o,i;(t=u,r=f,i=h.defer(),(o=function(){if(0==t.length)return j.resolvePromise(!0,i);var n=t.shift();x(n.name).then(function(e){n.hash=e.hash,r(n.name,"create"),0==t.length?i.resolve():setTimeout(function(){return o()},100)},function(e){e&&g.info(e),i.reject(e)})})(),i.promise).then(function(){var n,t,r,o;(n=c,t=f,o=h.defer(),(r=function(){if(0==n.length)return j.resolvePromise(!0,o);var e=n.shift();y(e.name,e.hash).then(function(){t(e.name,"upload"),0==n.length?o.resolve():setTimeout(function(){return r()},100)},function(e){e&&g.info(e),o.reject(e)})})(),o.promise).then(function(){a.resolve()},function(e){e&&g.info(e),a.reject(e)})},function(e){e&&g.info(e),a.reject(e)})},function(e){e&&g.info(e),a.reject(e)}),a.promise;var l,p,d,m})(n[0],n[1]).then(function(){g.debug("project sync success"),t.resolve()},function(e){g.debug("project sync fail"),e&&g.info(e),t.reject(e)},function(e){t.notify(e)})},function(e){e&&g.info(e),t.reject(e)}),t.promise}function m(){var n=h.defer();return g.debug("project list"),s.request(f.PROJECT_SYNC_LIST,{method:"post",data:{type:a}}).then(function(e){0==e.status?n.resolve(e.data.filter(function(e){return e.type==a})):n.reject(e.message)},function(e){e&&g.info(e),n.reject(e)}),n.promise}function x(t){var r=h.defer();return g.debug("project create: "+t),s.request(f.PROJECT_SYNC_CREATE,{method:"post",data:{name:t,type:a}}).then(function(e){if(0==e.status){var n=e.data;_(n.name,n.modify_time,n.hash).then(function(){g.debug("project create success: "+t+" "+n.hash),r.resolve(n)},function(e){e&&g.info(e),r.reject(e)})}else r.reject(e.message)},function(e){e&&g.info(e),r.reject(e)}),r.promise}function y(t,r){var e,n,o,i,a,u=h.defer();return g.debug("project upload: "+t+": "+r),(e=E(),n=t,o=h.defer(),i=v.join(j.getAppPath("appData"),"temp",j.uuid(6)+".7z"),a=[n+"/"+n+b],j.compress(e,a,i).then(function(){o.resolve(i)},function(e){e&&g.info(e),o.reject(e)}),o.promise).then(function(e){var n=f.PROJECT_SYNC_UPLOAD+"/"+r;s.request(n,{method:"post",body:c.createReadStream(e)}).then(function(e){if(0==e.status){var n=e.data;_(t,n.modify_time,r).then(function(){g.debug("project upload success: "+t),u.resolve(n)},function(e){e&&g.info(e),u.reject(e)})}else u.reject(e.message)},function(e){e&&g.info(e),u.reject(e)})},function(e){e&&g.info(e),u.reject(e)}),u.promise}function w(r,o){var i=h.defer();g.debug("project download: "+r+" "+o);var e=f.PROJECT_SYNC_DOWNLOAD+"/"+o;return s.request(e,{method:"post"},!1).then(function(e){var n=v.join(j.getAppPath("appData"),"temp",j.uuid(6)+".7z");c.ensureDirSync(v.dirname(n));var t=c.createWriteStream(n);e.body.pipe(t),e.body.on("end",function(){j.uncompress(n,E()).then(function(){_(r,null,o).then(function(){g.debug("project download success: "+r),i.resolve()},function(e){e&&g.info(e),i.reject(e)})},function(e){e&&g.info(e),i.resolve()})}).on("error",function(e){e&&g.info(e),i.resolve()})},function(e){e&&g.info(e),i.resolve()}),i.promise}function A(e,n,t,r){var o=h.defer();t.type=a,t.project_name=n,t.project_type=r||"local",t.updated_at=j.stamp();var i=v.join(e,n+b);return g.debug("project save: "+i),j.writeJson(i,t).then(function(){o.resolve({type:a,project_name:t.project_name,project_type:t.project_type,updated_at:t.updated_at,path:e})},function(e){e&&g.info(e),o.reject(e)}),o.promise}function I(){var e=h.defer();if(!s.getUser())return j.rejectPromise(null,e);var n=O();return c.existsSync(n)?j.readJson(n):j.resolvePromise([],e)}function S(e){return s.getUser()?j.writeJson(O(),e):j.rejectPromise()}function _(t,r,o){var i=h.defer();return r=r||j.stamp(),I().then(function(e){var n=e.find(function(e){return o&&e.hash==o||e.name==t});n?(t&&(n.name=t),o&&(n.hash=o),n.modify_time=r):e.push({name:t,hash:o,modify_time:r}),S(e).then(function(){i.resolve()},function(e){e&&g.info(e),i.reject(e)})},function(e){e&&g.info(e),i.reject(e)}),i.promise}function O(){var e=s.getUserId();return e?v.join(j.getAppPath("appData"),"projects",D(e,1),"list.json"):null}function E(){var e=s.getUserId();return e?v.join(j.getAppPath("appDocuments"),"projects",D(e)):null}function D(e,n){return n=n||0,r(""+e,{algorithm:"md5"}).substring(8*n,8*(n+1))}n.exports.check=P,n.exports.read=o,n.exports.open=function(e){var n=h.defer(),t=function(e){o(e).then(function(e){n.resolve(e)},function(e){e&&g.info(e),n.reject(e)})};if(e)return s.getUser()?(t(v.join(E(),e)),n.promise):j.rejectPromise(null,n);var r={};return r.defaultPath=s.getUser()?E():j.getAppPath("documents"),r.properties=["openDirectory"],j.showOpenDialog(r).then(function(e){t(e)},function(e){e&&g.info(e),n.reject(e)}),n.promise},n.exports.save=function(n,e,t){var r=h.defer();if(!s.getUser()){var o=v.join(j.getAppPath("appDocuments"),"projects");return t&&t.startsWith(o)&&(t=null),u(n,e,!1,t)}return A(t=v.join(E(),n),n,e,"cloud").then(function(e){_(n).then(function(){i(),r.resolve(e)},function(e){e&&g.info(e),r.reject(e)})},function(e){e&&g.info(e),r.reject(e)}),r.promise},n.exports.saveAs=u,n.exports.sync=d,n.exports.list=m,n.exports.create=x,n.exports.remove=function(n,o){var i=h.defer();return g.debug("project remove: "+o),s.request(f.PROJECT_SYNC_DELETE,{method:"post",data:{hash:o}}).then(function(e){var t,r;0==e.status?h.all([j.removeFile(v.join(E(),n)),(t=o,r=h.defer(),I().then(function(e){var n=e.findIndex(function(e){return e.hash==t});n<0?r.resolve():(e.splice(n,1),S(e).then(function(){r.resolve()},function(e){e&&g.info(e),r.reject(e)}))},function(e){e&&g.info(e),r.reject(e)}),r.promise)]).then(function(){g.debug("project remove success: "+n),i.resolve()},function(e){e&&g.info(e),i.reject(e)}):i.reject(e.message)},function(e){e&&g.info(e),i.reject(e)}),i.promise},n.exports.upload=y,n.exports.download=w},{"../config/url":4,"../util/util":12,"./token":9,"electron-log":void 0,"fs-extra":void 0,hasha:void 0,path:void 0,q:void 0}],8:[function(e,n,t){e("path");var u=e("electron-log"),c=e("q"),s=e("serialport"),f=s.parsers.Delimiter,l={autoPortId:0,ports:{}};n.exports.listSerialPort=function(){var t=c.defer();return u.debug("listSerialPort"),s.list(function(e,n){if(e)return u.info(e),void t.reject(e);0!=n.length?t.resolve(n):t.reject()}),t.promise},n.exports.openSerialPort=function(e,r,o){var i=c.defer();u.debug("openSerialPort: "+e+", options: "+JSON.stringify(r)),r.autoOpen=!1;var a=new s(e,r);return a.open(function(e){if(e)return u.info(e),void i.reject(e);var n=++l.autoPortId;(l.ports[n]=a).on("error",function(e){o&&o.onError&&o.onError(n,e)}),a.on("close",function(){delete l.ports[n],o&&o.onClose&&o.onClose(n)});var t="raw"==r.parser?a:a.pipe(new f({delimiter:Buffer.from(r.parser)}));t.on("readable",function(){var e=t.read();e&&o&&o.onData&&o.onData(n,e)}),a.flush(function(){i.resolve(n)})}),i.promise},n.exports.writeSerialPort=function(e,n){var t=c.defer();u.debug("writeSerialPort: "+e+", "+n);var r=l.ports[e];return r?r.write(Buffer.from(n),function(e){if(e)return u.info(e),void t.reject(e);r.drain(function(){t.resolve()})}):setTimeout(function(){return t.reject()},10),t.promise},n.exports.closeSerialPort=function(e){var n=c.defer();u.debug("closeSerialPort, portId: "+e);var t=l.ports[e];return t?t.close(function(){n.resolve()}):setTimeout(function(){return n.reject()},10),n.promise},n.exports.closeAllSerialPort=function(){for(var e in u.debug("closeAllSerialPort"),l.ports)l.ports[e].close();l.ports={}},n.exports.updateSerialPort=function(e,n){var t=c.defer();u.debug("updateSerialPort, portId: "+e);var r=l.ports[e];return r?r.update(n,function(){t.resolve()}):setTimeout(function(){return t.reject()},10),t.promise},n.exports.flushSerialPort=function(e,n){var t=c.defer();u.debug("flushSerialPort, portId: "+e);var r=l.ports[e];return r?r.flush(function(){t.resolve()}):setTimeout(function(){return t.reject()},10),t.promise},n.exports.resetSerialPort=function(e){var n=c.defer(),t=new s(e,{baudRate:1200});return t.on("open",function(){t.set({rts:!0,dtr:!1}),setTimeout(function(){t.close(function(){return n.resolve()})},650)}).on("error",function(e){u.info(e),t.close(function(){n.reject(e)})}),n.promise}},{"electron-log":void 0,path:void 0,q:void 0,serialport:void 0}],9:[function(e,n,t){e("path");var r,i,o=e("crypto"),a=e("q"),u=(e("fs-extra"),e("electron-log")),c=e("is-online"),s=e("../util/util"),f=e("../config/url"),l=e("../config/status"),p=e("../util/cache");function d(){i=null,v().removeItem("key",!1),v().removeItem("value",!1),v().save()}function m(e,n,t){if(!i)return s.rejectPromise();var r=s.getAppInfo(),o=n.headers||{};return o.Authorization="Bearer "+i.api_token,o["X-Ken-App-Version"]=r.name+"-"+r.version+"-"+r.branch+"-"+r.platform+"-"+r.appBit,n.headers=o,s.request(e,n,t)}function v(){return r||(r=new p("token")),r}n.exports.getUser=function(){return i&&i.user?i.user:null},n.exports.getUserId=function(){return i&&i.user?i.user.id:0},n.exports.load=function(){var n,t=a.defer(),e=v().getItem("key"),r=v().getItem("value");if(!e||!r)return s.rejectPromise(null,t);try{var o=s.decrypt(r,Buffer.from(e,"hex"));i=JSON.parse(o),(n=a.defer(),m(f.VERIFY,{method:"post"}).then(function(e){e.status==l.SUCCESS?n.resolve():n.reject(e.message)},function(e){e&&u.info(e),n.reject(e)}),n.promise).then(function(){t.resolve(i)},function(e){c().then(function(){return d()}).fin(function(){e&&u.info(e),t.reject(e)})})}catch(e){t.reject()}return t.promise},n.exports.save=function(e){try{var n=o.randomBytes(128);return v().setItem("key",n.toString("hex"),!1),v().setItem("value",s.encrypt(JSON.stringify(e),n),!1),v().save(),i=e,s.resolvePromise()}catch(e){return s.rejectPromise(e)}},n.exports.remove=d,n.exports.request=m},{"../config/status":3,"../config/url":4,"../util/cache":11,"../util/util":12,crypto:void 0,"electron-log":void 0,"fs-extra":void 0,"is-online":void 0,path:void 0,q:void 0}],10:[function(e,n,t){var i=e("q"),a=e("electron-log"),u=e("../util/util"),c=e("./token"),s=e("../config/url"),f=(e("../config/status"),/^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/);n.exports.loadToken=function(){var n=i.defer();return c.load().then(function(e){n.resolve(e.user)},function(e){e&&a.info(er),n.reject(e)}),n.promise},n.exports.login=function(e,n,t){var r=i.defer(),o={};return f.test(e)?o.email=e:o.username=e,o.password=n,u.request(s.LOGIN,{method:"POST",data:o}).then(function(e){0==e.status?c.save(e.data).fin(function(){r.resolve(e)}):r.resolve(e)},function(e){e&&a.info(er),r.reject(e)}),r.promise},n.exports.logout=function(){var n=i.defer();return c.remove(),u.request(s.LOGOUT).then(function(){n.resolve()},function(e){e&&a.info(e),n.reject(e)}),n.promise},n.exports.weixinLogin=function(e){var n=i.defer();return u.request(s.WEIXIN_LOGIN,{method:"POST",data:{auth_key:e}}).then(function(e){0==e.status||1==e.status?c.save(e.data).fin(function(){n.resolve(e)}):n.resolve(e)},function(e){e&&a.info(e),n.reject(e)}),n.promise},n.exports.weixinQrcode=function(){var n=i.defer();return u.request(s.WEIXIN_QRCODE).then(function(e){n.resolve(e)},function(e){e&&a.info(e),n.reject(e)}),n.promise},n.exports.register=function(e){var n=i.defer();return u.request(s.REGISTER,{method:"POST",data:{email:e.email,username:e.username,password:e.password,login:!0}}).then(function(e){n.resolve(e)},function(e){e&&a.info(e),n.reject(e)}),n.promise},n.exports.resetPassword=function(e){var n=i.defer();return u.request(s.FIND_PASSWORD,{method:"POST",data:{email:e}}).then(function(e){n.resolve(e)},function(e){e&&a.info(e),n.reject(e)}),n.promise}},{"../config/status":3,"../config/url":4,"../util/util":12,"./token":9,"electron-log":void 0,q:void 0}],11:[function(e,n,t){e("path"),e("crypto"),e("q"),e("fs-extra"),e("electron-log");var r=e("flat-cache"),o=e("./util"),i={};function a(e){if(i[e])return i[e];this.name=e,this._cache=r.load(e,o.getAppPath("appData")),i[e]=this}a.prototype.getItem=function(e,n){var t=this._cache.getKey(e);return void 0!==t?t:n},a.prototype.setItem=function(e,n,t){t=!1!==t,this._cache.setKey(e,n),t&&this._cache.save(!0)},a.prototype.removeItem=function(e,n){n=!1!==n,this._cache.removeKey(e),n&&this._cache.save(!0)},a.prototype.save=function(){this._cache.save(!0)},n.exports=a},{"./util":12,crypto:void 0,"electron-log":void 0,"flat-cache":void 0,"fs-extra":void 0,path:void 0,q:void 0}],12:[function(e,n,t){var r=e("os"),u=e("child_process"),o=e("path"),i=e("crypto"),a=e("electron"),c=a.app,s=a.ipcMain,f=a.dialog,l=a.BrowserWindow,p=e("electron-log"),d=e("electron-is"),m=e("q"),v=e("fs-extra"),h=e("globby"),g=e("sudo-prompt"),j=e("iconv-lite"),b=(e("lodash"),e("7zip-bin").path7za.replace("app.asar","app.asar.unpacked")),P=e("node-fetch"),x=e(d.dev()?o.resolve("app","package.json"):o.resolve(__dirname,"..","package.json")),y="-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC7Jat1/19NDxOObrFpW8USTia6\nuHt34Sac1Arm6F2QUzsdUEUmvGyLIOIGcdb+F6pTdx4ftY+wZi7Aomp4k3vNqXmX\nT0mE0vpQlCmsPUcMHXuUi93XTGPxLXIv9NXxCJZXSYI0JeyuhT9/ithrYlbMlyNc\nwKB/BwSpp+Py2MTT2wIDAQAB\n-----END PUBLIC KEY-----\n";d.dev()&&c.setName(x.productName);var w={},A=0;function I(){return d.windows()?"win":d.macOS()?"mac":0<=r.arch().indexOf("arm")?"arm":"linux"}function S(){return d.dev()?x.version:c.getVersion()}function _(e,n){switch(e){case"appData":return o.join(c.getPath("appData"),c.getName());case"appResource":return d.dev()?o.resolve("data"):o.resolve(c.getAppPath(),"..","..","data");case"appDocuments":return o.join(c.getPath("documents"),c.getName());case"script":return o.join(_("appResource"),"scripts",n+"."+(d.windows()?"bat":"sh"));case"driver":return o.join(_("appResource"),"driver");case"command":return o.join(_("appData"),"temp",""+O(6));case"libraries":return o.join(_("appDocuments"),"libraries");case"packages":return o.join(_("appDocuments"),"packages");case"arduino":return o.join(_("appResource"),"arduino-"+I());default:return c.getPath(e)}}function O(e,n){var t,r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(n=n||o.length,e)for(t=0;t<e;t++)i[t]=o[0|Math.random()*n];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",t=0;t<36;t++)i[t]||(r=0|16*Math.random(),i[t]=o[19==t?3&r|8:r]);return i.join("")}function E(){return parseInt(Date.now()/1e3)}function D(e,n){return n=n||m.defer(),setTimeout(function(){return n.resolve(e)},10),n.promise}function R(e,n,t){var r=m.defer();return n=n||{},t=t||!1,p.debug("execCommand:"+e+", options: "+JSON.stringify(n)+", useSudo: "+t),t?g.exec(e,{name:"kenrobot"},function(e,n,t){if(n=n||"",t=t||"",n=d.windows()?j.decode(Buffer.from(n),"win1252"):n,t=d.windows()?j.decode(Buffer.from(t),"win1252"):t,e)return p.info(e),n&&p.info(n),t&&p.info(t),void r.reject(e||t||n);d.dev()&&n&&p.debug(n),r.resolve(n)}):u.exec(e,n,function(e,n,t){if(n=n||"",t=t||"",n=d.windows()?j.decode(Buffer.from(n),"win1252"):n,t=d.windows()?j.decode(Buffer.from(t),"win1252"):t,e)return p.info(e),n&&p.info(n),t&&p.info(t),void r.reject(e||t||n);d.dev()&&n&&p.debug(n),r.resolve(n)}),r.promise}function T(e,n,t){var r=m.defer(),o=u.spawn(e,n,t),i="",a="";return o.stdout.on("data",function(e){var n=d.windows()?j.decode(e,"win1252"):e.toString();d.dev()&&n&&p.debug(n),i+=n,r.notify({type:"stdout",data:n})}),o.stderr.on("data",function(e){var n=d.windows()?j.decode(e,"win1252"):e.toString();d.dev()&&n&&p.debug(n),a+=n,r.notify({type:"stderr",data:n})}),o.on("close",function(e){0==e?r.resolve(i):r.reject(a)}),r.promise}function k(e,n,t,r){if(!r){var o=m.defer();return v.outputFile(e,n,t,function(e){if(e)return p.info(e),void o.reject(e);o.resolve()}),o.promise}v.outputFileSync(e,n,t)}function N(e,n){var t=m.defer();return(e=e||{}).title="保存",e.defaultPath=e.defaultPath&&o.isAbsolute(e.defaultPath)?e.defaultPath:o.join(_("documents"),e.defaultPath||"untitled"),e.buttonLabel="保存",n=n||l.getAllWindows()[0],f.showSaveDialog(n,e,function(e){e?t.resolve(e):t.reject()}),t.promise}n.exports.getPlatform=I,n.exports.getVersion=S,n.exports.getAppInfo=function(){var e={bit:"x64"===process.arch||process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432")?64:32,arch:process.arch,platform:I(),version:S(),name:c.getName(),buildNumber:x.buildNumber,dev:d.dev()};return d.dev()?(e.ext=o.extname(_("exe")).replace(".",""),e.branch="beta",e.feature="",e.date=E(),e.appBit=e.bit):(e.ext=x.buildInfo.ext,e.branch=x.buildInfo.branch,e.feature=x.buildInfo.feature,e.date=x.buildInfo.date,e.appBit=x.buildInfo.appBit),e},n.exports.getAppPath=_,n.exports.getExpire=function(){return!d.dev()&&x.buildInfo.expire},n.exports.formatDate=function(e,n){"number"==typeof e?e=new Date(e):e||(e=new Date);var t={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours()%12==0?12:e.getHours()%12,"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(n)&&(n=n.replace(RegExp.$1,(1<RegExp.$1.length?2<RegExp.$1.length?"星期":"周":"")+["日","一","二","三","四","五","六"][e.getDay()]));for(var r in t)new RegExp("("+r+")").test(n)&&(n=n.replace(RegExp.$1,1===RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return n},n.exports.versionCompare=function(e,n){for(var t=/(\d+)\.(\d+)\.(\d+)/,r=t.exec(e),o=t.exec(n),i=[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],a=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])],u=0;u<=2;u++)if(i[u]!=a[u])return a[u]<i[u]?1:-1;return 0},n.exports.postMessage=function(e){for(var n=arguments.length,t=Array(1<n?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];p.debug("postMessage: "+e+", "+t.join(", "));var o=l.getAllWindows();o&&o.length&&o[0].webContents.send(e,t)},n.exports.listenMessage=function(e,i){var a=this,u="app:"+e;s.on(u,function(n,t){for(var e=arguments.length,r=Array(2<e?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];(i.apply(a,r)||D()).then(function(e){n.sender.send(u,t,!0,e)},function(e){n.sender.send(u,t,!1,e)},function(e){n.sender.send(u,t,"notify",e)})})},n.exports.getDefer=function(){var e=m.defer(),n=A++;return{deferId:n,promise:(w[n]=e).promise}},n.exports.callDefer=function(e,n){var t=w[e];if(t){var r;"notify"===n?r=t.notify:(delete w[e],r=n?t.resolve:t.reject);for(var o=arguments.length,i=Array(2<o?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];r.apply(this,i)}},n.exports.handleQuotes=function(e){return d.windows()?e:e.replace(/"/g,"")},n.exports.uuid=O,n.exports.stamp=E,n.exports.throttle=function(e,n){var t;return function(){t&&clearTimeout(t),t=setTimeout(function(){e(),clearTimeout(t),t=null},n)}},n.exports.encrypt=function(e,n,t){t=t||"aes-128-cbc";var r=i.createCipher(t,n),o=r.update(e,"utf8","binary");return o+=r.final("binary"),o=new Buffer(o,"binary").toString("base64")},n.exports.decrypt=function(e,n,t){t=t||"aes-128-cbc",e=new Buffer(e,"base64").toString("binary");var r=i.createDecipher(t,n),o=r.update(e,"binary","utf8");return o+=r.final("utf8")},n.exports.rsa_encrypt=function(e,n){n=n||y;var t=new Buffer(e);return i.publicEncrypt({key:n,padding:i.constants.RSA_PKCS1_PADDING},t).toString("base64")},n.exports.rsa_decrypt=function(e,n){var t=new Buffer(e,"base64");return i.privateDecrypt({key:n,padding:i.constants.RSA_PKCS1_PADDING},t).toString("utf8")},n.exports.resolvePromise=D,n.exports.rejectPromise=function(e,n){return n=n||m.defer(),setTimeout(function(){return n.reject(e)},10),n.promise},n.exports.execFile=function(e,n){return p.debug("execFile: "+e),R(d.windows()?"start /WAIT "+e:""+e,null,n)},n.exports.execCommand=R,n.exports.spawnCommand=T,n.exports.readFile=function(e,n,t){if(t)return v.readFileSync(e,n);var r=m.defer();return n=n||"utf8",v.readFile(e,n,function(e,n){if(e)return p.info(e),void r.reject(e);r.resolve(n)}),r.promise},n.exports.writeFile=k,n.exports.saveFile=function(e,n,t){var r=m.defer();return t=t||{},e&&(t.defaultPath=e),N(t).then(function(e){k(e,n,t).then(function(){r.resolve()},function(e){e&&p.info(e),r.reject(e)})},function(e){e&&p.info(e),r.reject(e)}),r.promise},n.exports.moveFile=function(e,n,t){var r=m.defer();return t=t||{overwrite:!0},v.move(e,n,t,function(e){if(e)return p.info(e),void r.reject(e);r.resolve()}),r.promise},n.exports.removeFile=function(e,n){if(!n){var t=m.defer();return v.remove(e,function(e){if(e)return p.info(e),void t.reject(e);t.resolve()}),t.promise}v.removeSync(e)},n.exports.readJson=function(e,n){var t=m.defer();return n=n||{},v.readJson(e,n,function(e,n){if(e)return p.info(e),void t.reject(e);t.resolve(n)}),t.promise},n.exports.writeJson=function(e,n,t,r){if(!r){var o=m.defer();return t=t||{},v.outputJson(e,n,t,function(e){if(e)return p.info(e),void o.reject(e);o.resolve()}),o.promise}v.outputJsonSync(e,n,t)},n.exports.searchFiles=function(e){var n=m.defer();return p.debug("searchFiles: "+e),h(e).then(function(e){n.resolve(e)},function(e){e&&p.info(e),n.reject(e)}),n.promise},n.exports.compress=function(e,n,t,r){var o=m.defer();return n=n||[n],r=r||"7z",p.debug("compress: "+e+": "+n.length+" => "+t+": "+r),R("cd "+(d.windows()?"/d ":"")+e+' && "'+b+'" a -t'+r+' -r "'+t+'" '+n.join(" ")).then(function(){o.resolve()},function(e){e&&p.info(e),o.reject(e)}),o.promise},n.exports.uncompress=function(e,n,t){var r=m.defer(),o=/([\d]+)% \d+ - .*\r?/g;return p.debug("uncompress: "+e+" => "+n),t?T('"'+b+'"',["x",'"'+e+'"',"-bsp1","-y",'-o"'+n+'"'],{shell:!0}).then(function(e){r.resolve(e)},function(e){e&&p.info(e),r.reject(e)},function(e){if(o.lastIndex=0,o.test(e.data)){for(var n,t=o.exec(e.data);n=t,t=o.exec(e.data););r.notify(parseInt(n[1]))}}):R('"'+b+'" x "'+e+'" -y -o"'+n+'"').then(function(){r.resolve()},function(e){e&&p.info(e),r.reject(e)}),r.promise},n.exports.showOpenDialog=function(e,n){var t=m.defer();return(e=e||{}).title="打开",e.defaultPath=e.defaultPath||_("documents"),e.buttonLabel="打开",n=n||l.getAllWindows()[0],f.showOpenDialog(n,e,function(e){e?t.resolve(e[0]):t.reject()}),t.promise},n.exports.showSaveDialog=N,n.exports.request=function(e,n,t){var r=m.defer();if(t=!1!==t,(n=n||{}).method=n.method||"GET",t&&n.data){n.body=JSON.stringify(n.data);var o=n.headers||(n.headers={});o["Content-Type"]="application/json",o.Accept="application/json",delete n.data}return P(e,n).then(function(e){if(e.ok)return t?e.json():e;var n=new Error(e.statusText);throw n.status=e.status,n}).then(function(e){r.resolve(e)}).catch(function(e){e&&p.info(e),r.reject(e)}),r.promise}},{"7zip-bin":void 0,child_process:void 0,crypto:void 0,electron:void 0,"electron-is":void 0,"electron-log":void 0,"fs-extra":void 0,globby:void 0,"iconv-lite":void 0,lodash:void 0,"node-fetch":void 0,os:void 0,path:void 0,q:void 0,"sudo-prompt":void 0}]},{},[5]);